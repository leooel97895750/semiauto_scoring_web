(this.webpackJsonpscoring_web=this.webpackJsonpscoring_web||[]).push([[0],{107:function(e,t,a){},112:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(26),s=a.n(r),i=(a(83),a(7)),l=a(8),h=a(11),c=a(10),p=a(75),u=a(36),d=a(9),g=a.n(d),m=a(13),f=a(4),v=a(12),b=a.n(v),y=a(28),w=a(16),S=a(30),E=a(48),x=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleSubmit=n.handleSubmit.bind(Object(f.a)(n)),n.state={waitingForResponse:!1,errorMessage:null},n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)"}},o.a.createElement(y.a,{style:{width:"30rem"}},o.a.createElement(y.a.Header,{as:"h5"},"\u767b\u5165"),o.a.createElement(y.a.Body,null,o.a.createElement(w.a,{onSubmit:this.handleSubmit},o.a.createElement(w.a.Group,{controlId:"formAccount"},o.a.createElement(w.a.Label,null,"\u5e33\u865f"),o.a.createElement(w.a.Control,null)),o.a.createElement(w.a.Group,{controlId:"formPassword"},o.a.createElement(w.a.Label,null,"\u5bc6\u78bc"),o.a.createElement(w.a.Control,{type:"password"})),this.state.waitingForResponse||!this.state.errorMessage?null:o.a.createElement(E.a,{variant:"danger"},this.state.errorMessage),o.a.createElement(S.a,{variant:"primary",type:"submit",disabled:this.state.waitingForResponse},this.state.waitingForResponse?"\u767b\u5165\u4e2d":"\u767b\u5165")))))}},{key:"handleSubmit",value:function(){var e=Object(m.a)(g.a.mark((function e(t){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({waitingForResponse:!0}),e.next=4,b.a.post("/ajax_login",{account:t.target.elements.formAccount.value,password:t.target.elements.formPassword.value});case 4:a=e.sent,this.setState({waitingForResponse:!1}),a.data.success?(this.setState({errorMessage:null}),this.props.onLogin()):this.setState({errorMessage:a.data.msg});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(n.Component),I=a(17);var C=function(e){for(var t=o.a.forwardRef((function(e,t){var a=e.children,n=e.onClick;return o.a.createElement("a",{href:"/#/",ref:t,onClick:function(e){e.preventDefault(),n(e)}},a,"\u25bc")})),a=[],n=1;n<=e.totalNumber;n++){var r=n;a.push(o.a.createElement(I.a.Item,{key:r,eventKey:r},"\u7b2c "+r+" \u6b21\u7d50\u679c"))}return a.push(o.a.createElement(I.a.Divider,{key:"divider"})),a.push(o.a.createElement(I.a.Item,{key:0,eventKey:0},e.paused?"\u7e7c\u7e8c":"\u65b0\u589e")),o.a.createElement(I.a,{onSelect:e.selectItem,style:{display:"inline-block"}},o.a.createElement(I.a.Toggle,{as:t,id:"dropdown-filename"},e.fileName),o.a.createElement(I.a.Menu,null,a))};var T=function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement(y.a,{style:{width:"40rem",marginLeft:"auto",marginRight:"auto"}},o.a.createElement(y.a.Body,null,o.a.createElement(C,{totalNumber:e.totalNumber,fileName:e.fileName,selectItem:e.selectItem,paused:e.paused}),0!==e.totalNumber?o.a.createElement("a",{href:"/download?id="+e.psgFileId,style:{float:"right"}},"\u4e0b\u8f09"):null)),o.a.createElement("br",null))},k=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={files:[]},n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,this.state.files.map((function(e,t){return o.a.createElement(T,{key:t,totalNumber:e.scoringTimes,fileName:e.name,selectItem:function(t){window.location.href="#/scoring/"+e.psgFileId+"/"+t},psgFileId:e.psgFileId,paused:e.paused})})))}},{key:"componentDidMount",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t,a,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/ajax_list_files",{});case 2:if((t=e.sent).data.success){e.next=7;break}return alert(t.data.msg),window.history.go(0),e.abrupt("return");case 7:for(console.log(t.data.psgInfo),a=[],n=0;n<t.data.psgInfo.length;n++)"#"!==t.data.psgInfo[n].name[0]&&a.push(t.data.psgInfo[n]);console.log(a),this.setState({files:a});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(n.Component),O=a(20);var D=function(e){var t=o.a.forwardRef((function(e,t){var a=e.children,n=e.onClick;return o.a.createElement("a",{href:"/#/",ref:t,onClick:function(e){e.preventDefault(),n(e)}},a,"\u25bc")}));return o.a.createElement(I.a,{onSelect:function(){var t=Object(m.a)(g.a.mark((function t(a){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("set_pass"!==a){t.next=4;break}window.location.href="#/setpass",t.next=9;break;case 4:if("logout"!==a){t.next=9;break}return t.next=7,b.a.post("/ajax_logout",{});case 7:t.sent.data.success&&e.onLogout();case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},o.a.createElement(I.a.Toggle,{as:t,id:"account-dropdown"},e.account),o.a.createElement(I.a.Menu,null,o.a.createElement(I.a.Item,{eventKey:"set_pass",style:{color:"black"}},"\u66f4\u6539\u5bc6\u78bc"),o.a.createElement(I.a.Item,{eventKey:"logout",style:{color:"black"}},"\u767b\u51fa")))};var F=function(e){return o.a.createElement(O.a,{bg:"dark",variant:"dark",fixed:"top"},o.a.createElement("div",{style:{width:"150px"}}),o.a.createElement(O.a.Brand,{href:"/#/"},"Scoring Web"),null!==e.account?o.a.createElement(O.a.Collapse,{className:"justify-content-end"},o.a.createElement(O.a.Collapse,{className:"justify-content-end"},o.a.createElement(O.a.Text,null,o.a.createElement(D,{account:e.account,onLogout:e.onLogout})),o.a.createElement("div",{style:{width:"150px"}}))):null)};var M=function(e){return o.a.createElement(O.a,{bg:"dark",variant:"dark",fixed:"bottom"},o.a.createElement(O.a.Collapse,null,o.a.createElement(O.a.Text,{style:{fontSize:"12px",margin:"0 auto"}},"National Cheng Kung University Hospital ",o.a.createElement("a",{href:"/#/"},"\u6210\u5927\u7761\u7720\u4e2d\u5fc3"),o.a.createElement("br",null),"cooperates with National Cheng Kung University Department of Computer Science and Information Engineering NCBCI Lab\u6210\u5927\u8cc7\u8a0a\u5de5\u7a0b\u6240",o.a.createElement("a",{href:"/#/"},"\u795e\u7d93\u904b\u7b97\u8207\u8166\u6a5f\u4ecb\u9762\u5be6\u9a57\u5ba4"))))},L=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).checkAccountAndSetState=n.checkAccountAndSetState.bind(Object(f.a)(n)),n.state={display:!1,account:null},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(F,{account:this.state.account,onLogout:function(){e.setState({account:null})}}),this.state.display?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{height:"70px"}}),null!==this.state.account?o.a.createElement(k,null):o.a.createElement(x,{onLogin:function(){e.checkAccountAndSetState()}}),o.a.createElement("div",{style:{height:"60px"}})):null,o.a.createElement(M,null))}},{key:"componentDidMount",value:function(){var e=Object(m.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkAccountAndSetState();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkAccountAndSetState",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/ajax_who_am_i",{});case 2:void 0!==(t=e.sent).data.account&&this.setState({account:t.data.account}),this.setState({display:!0});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(n.Component),j=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={files:[]},n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,this.state.files.map((function(e,t){return o.a.createElement(T,{key:t,totalNumber:e.scoringTimes,fileName:e.name,selectItem:function(t){window.location.href="#/scoring/"+e.psgFileId+"/"+t},psgFileId:e.psgFileId,paused:e.paused})})))}},{key:"componentDidMount",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t,a,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/ajax_list_files",{});case 2:if((t=e.sent).data.success){e.next=7;break}return alert(t.data.msg),window.history.go(0),e.abrupt("return");case 7:for(console.log(t.data.psgInfo),a=[],n=0;n<t.data.psgInfo.length;n++)a.push(t.data.psgInfo[n]);console.log(a),this.setState({files:a});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(n.Component),A=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).checkAccountAndSetState=n.checkAccountAndSetState.bind(Object(f.a)(n)),n.state={display:!1,account:null},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(F,{account:this.state.account,onLogout:function(){e.setState({account:null})}}),this.state.display?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{height:"70px"}}),null!==this.state.account?o.a.createElement(j,null):o.a.createElement(x,{onLogin:function(){e.checkAccountAndSetState()}}),o.a.createElement("div",{style:{height:"60px"}})):null,o.a.createElement(M,null))}},{key:"componentDidMount",value:function(){var e=Object(m.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkAccountAndSetState();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkAccountAndSetState",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/ajax_who_am_i",{});case 2:void 0!==(t=e.sent).data.account&&this.setState({account:t.data.account}),this.setState({display:!0});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(n.Component);var R=function(e){return o.a.createElement(O.a,{bg:"dark",variant:"dark"},o.a.createElement("div",{style:{width:"150px"}}),o.a.createElement(O.a.Brand,{href:"/#/"},"Scoring Web"),e.editable?o.a.createElement(o.a.Fragment,null,o.a.createElement(w.a,null,e.hasStagesBeenLoaded?o.a.createElement(o.a.Fragment,null,o.a.createElement(S.a,{variant:"secondary",onClick:e.onComplete,disabled:e.buttonDisabled},"\u5b8c\u6210")):null)):null,e.hasStagesBeenLoaded&&e.hasAnswer?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{width:"30px"}}),o.a.createElement("input",{type:"checkbox",id:"showAnswer",name:"showAnswer",value:"showAnswer",disabled:e.enableShowAnswerCheckbox?"":"disabled",onChange:function(t){e.onShowAnswerChecked(t.target.checked)}}),o.a.createElement(O.a.Text,null,"\u986f\u793a\u81ea\u52d5\u5224\u8b80")):null,e.editable?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{width:"30px"}}),o.a.createElement(O.a.Text,null,e.stateToShow)):null,o.a.createElement(O.a.Collapse,{className:"justify-content-end"},o.a.createElement(O.a.Text,null,o.a.createElement(D,{account:e.account,onLogout:e.onLogout})),o.a.createElement("div",{style:{width:"150px"}})))},P=a(18),B=a.n(P),z=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).ref=o.a.createRef(),e}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("canvas",{ref:this.ref,width:this.props.width,height:this.props.height,className:B.a.fill})}},{key:"updateCanvas",value:function(){var e=this.ref.current,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.lineWidth=this.props.lineWidth,t.strokeStyle=this.props.color,t.beginPath();var a=this.props.epochToXPosition(0),n=this.props.stageToYPosition(this.props.stages[0]),o=this.props.stages[0];t.moveTo(a,n);for(var r=1;r<this.props.stages.length;r++)this.props.stages[r]!==o&&(a=this.props.epochToXPosition(r),t.lineTo(a,n),n=this.props.stageToYPosition(this.props.stages[r]),10===this.props.stages[r]||10===o?t.moveTo(a,n):t.lineTo(a,n),o=this.props.stages[r]);a=this.props.epochToXPosition(this.props.stages.length),t.lineTo(a,n),t.strokeStyle=this.props.color,t.stroke()}},{key:"componentDidMount",value:function(){this.updateCanvas()}},{key:"componentDidUpdate",value:function(){this.updateCanvas()}}]),a}(n.Component),W=a(72),_=a.n(W),q=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).ref=o.a.createRef(),n.draggingButton=-1,n.mouseDown=n.mouseDown.bind(Object(f.a)(n)),n.mouseMove=n.mouseMove.bind(Object(f.a)(n)),n.mouseUp=n.mouseUp.bind(Object(f.a)(n)),n.mouseLeave=n.mouseLeave.bind(Object(f.a)(n)),n.preventDragHandler=n.preventDragHandler.bind(Object(f.a)(n)),n.mouseScroll=n.mouseScroll.bind(Object(f.a)(n)),n.toChannelIdProportion=n.toChannelIdProportion.bind(Object(f.a)(n)),n.mousewheel=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel",n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("div",{ref:this.ref,className:_.a.chartLayer,onDragStart:this.preventDragHandler})}},{key:"toChannelIdProportion",value:function(e,t){var a=this.ref.current.getBoundingClientRect(),n=e-a.left,o=t-a.top;return{channelId:this.props.verticalPositionToChannelId(o),proportion:this.props.horizontalPositionToProportion(n)}}},{key:"mouseDown",value:function(e){if(0===e.button||2===e.button){-1!==this.draggingButton&&(this.draggingButton=-1,this.props.dragCancel&&this.props.dragCancel());var t=this.toChannelIdProportion(e.clientX,e.clientY),a=t.channelId,n=t.proportion;0===e.button?(this.draggingButton=0,this.props.onLeftDragStart&&this.props.onLeftDragStart(a,n)):2===e.button&&(this.draggingButton=2,this.props.onRightDragStart&&this.props.onRightDragStart(a,n))}}},{key:"mouseMove",value:function(e){var t=this.toChannelIdProportion(e.clientX,e.clientY),a=t.channelId,n=t.proportion;0===this.draggingButton?this.props.onLeftDrag&&this.props.onLeftDrag(n):2===this.draggingButton?this.props.onRightDrag&&this.props.onRightDrag(n):this.props.onMouseMove&&this.props.onMouseMove(a,n)}},{key:"mouseUp",value:function(e){if(0===e.button||2===e.button){var t=this.toChannelIdProportion(e.clientX,e.clientY).proportion;this.draggingButton===e.button&&(0===this.draggingButton?this.props.onLeftDragEnd&&this.props.onLeftDragEnd(t):2===this.draggingButton&&this.props.onRightDragEnd&&this.props.onRightDragEnd(t),this.draggingButton=-1)}}},{key:"mouseLeave",value:function(e){0!==this.draggingButton&&2!==this.draggingButton||(this.draggingButton=-1,this.props.dragCancel&&this.props.dragCancel())}},{key:"mouseScroll",value:function(e){var t=this.toChannelIdProportion(e.pageX,e.pageY).channelId;e.wheelDelta>0||e.detail<0?this.props.onMouseScroll&&this.props.onMouseScroll(t,!1):this.props.onMouseScroll&&this.props.onMouseScroll(t,!0)}},{key:"preventContextMenu",value:function(e){e.preventDefault()}},{key:"preventDragHandler",value:function(e){e.preventDefault()}},{key:"componentDidMount",value:function(){var e=this.ref.current;e.addEventListener("mousedown",this.mouseDown),e.addEventListener("mousemove",this.mouseMove),e.addEventListener("mouseup",this.mouseUp),e.addEventListener("mouseleave",this.mouseLeave),e.addEventListener("contextmenu",this.preventContextMenu),e.addEventListener(this.mousewheel,this.mouseScroll)}},{key:"componentWillUnmount",value:function(){var e=this.ref.current;e.removeEventListener("mousedown",this.mouseDown),e.removeEventListener("mousemove",this.mouseMove),e.removeEventListener("mouseup",this.mouseUp),e.removeEventListener("mouseleave",this.mouseLeave),e.removeEventListener("contextmenu",this.preventContextMenu),e.removeEventListener(this.mousewheel,this.mouseScroll)}}]),a}(n.Component);var N=function(e){for(var t=[],a=0;a<e.verticalLines.length;a++){var n=e.verticalLines[a],r=e.secondToXPosition(n.second);t.push(o.a.createElement("line",{x1:r,y1:e.bottomBoundary,x2:r,y2:e.topBoundary,stroke:n.color,strokeDasharray:n.dashed?"4":"",key:n.second}))}for(var s=0;s<e.horizontalLines.length;s++){var i=e.horizontalLines[s];if(i.zoomToShow||!e.isZoomed(i.channelId)){var l=e.valueToYPosition(i.channelId,i.value);t.push(o.a.createElement("line",{x1:e.leftBoundary,y1:l,x2:e.rightBoundary,y2:l,stroke:i.color,strokeDasharray:i.dashed?"4":"",key:i.channelId+"_"+i.value}))}}return o.a.createElement("svg",{width:e.width,height:e.height,className:B.a.fill},t)};function U(e,t,a,n){var o=(n-a)/(t-e);return function(t){return(t-e)*o+a}}var H=function(e){for(var t=U(0,e.buffered.length,e.leftBoundary,e.rightBoundary),a=[],n=!1,r=null,s="rgba(100, 100, 100, 0.3)",i=0;i<e.buffered.length;i++)if(n){if(!e.buffered[i]){var l=t(i);a.push(o.a.createElement("rect",{key:i,x:r,y:e.topBoundary,width:l-r,height:e.bottomBoundary-e.topBoundary,style:{fill:s}})),n=!1}}else e.buffered[i]&&(r=t(i),n=!0);var h=e.buffered.length,c=t(h);return n&&a.push(o.a.createElement("rect",{key:h,x:r,y:e.topBoundary,width:c-r,height:e.bottomBoundary-e.topBoundary,style:{fill:s}})),o.a.createElement("svg",{className:B.a.fill,width:e.width,height:e.height},a)};var X=function(e){var t=U(0,1,e.leftBoundary,e.rightBoundary)(e.proportion);return o.a.createElement("svg",{width:e.width,height:e.height,className:B.a.fill},o.a.createElement("line",{x1:t,x2:t,y1:e.bottomBoundary,y2:e.topBoundary,className:B.a.redLine}))},Z=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).updateCanvas=n.updateCanvas.bind(Object(f.a)(n)),n.ref=o.a.createRef(),n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("canvas",{ref:this.ref,width:this.props.width,height:this.props.height,className:B.a.fill})}},{key:"updateCanvas",value:function(){var e=this.ref.current,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.textBaseline="middle";for(var a=0;a<this.props.labels.length;a++){var n=this.props.labels[a],o=this.props.gravityToXPosition(n.gravity);o+=n.xOffset;var r=this.props.valueToYPosition(n.channelId,n.value);r+=n.yOffset,t.textAlign="left"===n.gravity?"left":"right"===n.gravity?"right":"center",t.fillStyle=n.color,t.font=n.font,t.fillText(n.label,o,r)}}},{key:"componentDidMount",value:function(){this.updateCanvas()}},{key:"componentDidUpdate",value:function(){this.updateCanvas()}}]),a}(n.Component),Y={horizontalLines:[{channelId:0,value:3,dashed:!1,color:"#c0c0c0"},{channelId:0,value:2,dashed:!1,color:"#c0c0c0"},{channelId:0,value:1,dashed:!1,color:"#c0c0c0"},{channelId:0,value:0,dashed:!1,color:"#c0c0c0"},{channelId:0,value:-1,dashed:!1,color:"#c0c0c0"},{channelId:0,value:-2,dashed:!1,color:"#c0c0c0"}],verticalLines:[]},K=[{label:"?",gravity:"center",channelId:0,value:-2,xOffset:0,yOffset:0,color:"black",font:"20px"},{label:"R",gravity:"center",channelId:0,value:-1,xOffset:0,yOffset:0,color:"black",font:"20px"},{label:"W",gravity:"center",channelId:0,value:0,xOffset:0,yOffset:0,color:"black",font:"20px"},{label:"N1",gravity:"center",channelId:0,value:1,xOffset:0,yOffset:0,color:"black",font:"20px"},{label:"N2",gravity:"center",channelId:0,value:2,xOffset:0,yOffset:0,color:"black",font:"20px"},{label:"N3",gravity:"center",channelId:0,value:3,xOffset:0,yOffset:0,color:"black",font:"20px"}];var V=function(e,t,a){return a>e?t<e?e:t>a?a:t:t>e?e:t<a?a:t},G=a(56),Q=a.n(G),J=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).ref=o.a.createRef(),n.firstTime=!0,n.state={height:0,width:0},n.windowResize=n.windowResize.bind(Object(f.a)(n)),n.mouseOnProportion=n.mouseOnProportion.bind(Object(f.a)(n)),n.mouseOnScroll=n.mouseOnScroll.bind(Object(f.a)(n)),n.gravityToXPosition=n.gravityToXPosition.bind(Object(f.a)(n)),n}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=U(0,this.props.stages.length,this.props.leftSpace,this.state.width-this.props.rightSpace),a=U(-2.5,3.5,this.props.topSpace,this.state.height-this.props.bottomSpace),n=U(this.props.leftSpace,this.state.width-this.props.rightSpace,0,1),r=this.props.currentEpoch/this.props.stages.length,s=this.firstTime?o.a.createElement("div",{ref:this.ref,className:Q.a.hypnogram}):o.a.createElement("div",{ref:this.ref,className:Q.a.hypnogram},o.a.createElement(N,{width:this.state.width,height:this.state.height,leftBoundary:this.props.leftSpace,rightBoundary:this.state.width-this.props.rightSpace,topBoundary:this.props.topSpace,bottomBoundary:this.state.height-this.props.bottomSpace,secondToXPosition:U(0,this.props.stages.length,this.props.leftSpace,this.state.width-this.props.rightSpace),verticalLines:Y.verticalLines,valueToYPosition:function(e,t){return a(t)},horizontalLines:Y.horizontalLines,isZoomed:function(){return!1}}),o.a.createElement(H,{width:this.state.width,height:this.state.height,leftBoundary:this.props.leftSpace,rightBoundary:this.state.width-this.props.rightSpace,topBoundary:this.props.topSpace,bottomBoundary:this.state.height-this.props.bottomSpace,buffered:this.props.buffered}),this.props.answer?o.a.createElement(z,{width:this.state.width,height:this.state.height,lineWidth:1,color:"orange",epochToXPosition:t,stageToYPosition:a,stages:this.props.answer}):null,this.props.modeArr?o.a.createElement(z,{width:this.state.width,height:this.state.height,lineWidth:1,color:"blue",epochToXPosition:t,stageToYPosition:a,stages:this.props.modeArr}):null,o.a.createElement(z,{width:this.state.width,height:this.state.height,lineWidth:1,color:"black",epochToXPosition:t,stageToYPosition:a,stages:this.props.stages}),o.a.createElement(X,{width:this.state.width,height:this.state.height,leftBoundary:this.props.leftSpace,rightBoundary:this.state.width-this.props.rightSpace,topBoundary:this.props.topSpace,bottomBoundary:this.state.height-this.props.bottomSpace,proportion:r}),o.a.createElement(Z,{width:this.state.width,height:this.state.height,gravityToXPosition:this.gravityToXPosition,labels:K,valueToYPosition:function(e,t){return a(t)}}),o.a.createElement(q,{horizontalPositionToProportion:n,verticalPositionToChannelId:function(){return 0},onRightDragStart:function(t,a){e.mouseOnProportion(a)},onRightDrag:this.mouseOnProportion,onRightDragEnd:this.mouseOnProportion,onLeftDragStart:function(t,a){e.mouseOnProportion(a)},onLeftDrag:this.mouseOnProportion,onLeftDragEnd:this.mouseOnProportion,onMouseScroll:function(t,a){e.mouseOnScroll(a)}}));return this.firstTime=!1,s}},{key:"windowResize",value:function(){var e=this.ref.current;this.setState({width:e.offsetWidth,height:e.offsetHeight})}},{key:"mouseOnProportion",value:function(e){var t=e*this.props.stages.length;t=V(0,t,this.props.stages.length-1),(t=Math.round(t))!==this.props.currentEpoch&&this.props.jumpTo(t)}},{key:"mouseOnScroll",value:function(e){var t=this.props.currentEpoch+(e?1:-1);(t=V(0,t,this.props.stages.length-1))!==this.props.currentEpoch&&this.props.jumpTo(t)}},{key:"gravityToXPosition",value:function(e){return"left"===e?0:"right"===e?this.props.leftSpace:this.props.leftSpace/2}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.windowResize);var e=this.ref.current;this.setState({width:e.offsetWidth,height:e.offsetHeight})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.windowResize)}}]),a}(n.Component);var $=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).updateCanvas=n.updateCanvas.bind(Object(f.a)(n)),n.ref=o.a.createRef(),n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("canvas",{ref:this.ref,width:this.props.width,height:this.props.height,className:B.a.fill})}},{key:"shouldComponentUpdate",value:function(e,t){return e.chartKey!==this.props.chartKey}},{key:"updateCanvas",value:function(){var e=this.ref.current,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.lineWidth=this.props.lineWidth,t.strokeStyle=this.props.color,t.beginPath();var a=[],n=[],o=this.props.xTransform(0),r=this.props.data(0);a.push(r);var s=this.props.yTransform(r),i=[],l=[];t.moveTo(o,s);for(var h=1;h<this.props.dataLength;h++)o=this.props.xTransform(h),r=this.props.data(h),a.push(r),s=this.props.yTransform(r),t.lineTo(o,s),this.props.showLocalExtreme&&(i.push(o),l.push(r.toFixed(0)));if(this.props.showLocalExtreme){(function(e){var t={};e.forEach((function(e){t[e]=(t[e]||0)+1}));var a=0,n=[];for(var o in t)t[o]>a?(a=t[o],n=[o]):t[o]===a&&n.push(o);return n})(l)[0],Math.round(this.props.dataLength/6);for(var c=l[0],p=1,u=1;u<this.props.dataLength;u++)c===l[u]?p++:(n.push({x:u-Math.floor(p/2),y:this.props.data(u)}),p=1),c=l[u]}if(t.strokeStyle=this.props.color,t.stroke(),t.font="12px Arial",t.textBaseline="hanging",t.textAlign="center",this.props.showLocalExtreme)for(var d=0,g=0;g<n.length;g++){var m=this.props.xTransform(n[g].x),f=this.props.yTransform(n[g].y)+10;m-d>14&&(t.fillText(n[g].y.toFixed(0),m,f),d=m)}}},{key:"componentDidMount",value:function(){this.updateCanvas()}},{key:"componentDidUpdate",value:function(){this.updateCanvas()}}]),a}(n.Component);var ee=function(e){for(var t=[],a=0;a<e.events.length;a++){var n=e.events[a],r=e.getChannelCenterline(n.channelId),s=V(0,n.secondFrom,e.interval),i=V(0,n.secondTo,e.interval),l=e.secondToXPosition(s),h=e.secondToXPosition(i)-l,c=r-e.eventHeight/2;t.push(o.a.createElement("rect",{key:n.eventId+"_"+n.channelId,x:l,y:c,width:h,height:e.eventHeight,style:{fill:n.color,fillOpacity:.5}}));var p=r+e.eventHeight/2;t.push(o.a.createElement("text",{key:n.eventId+"_"+n.channelId+"_text",x:l,y:p},n.type))}if(e.editingEvent){var u=e.getChannelCenterline(e.editingEvent.channelId),d=V(0,e.editingEvent.secondFrom,e.interval),g=V(0,e.editingEvent.secondTo,e.interval),m=e.secondToXPosition(d),f=e.secondToXPosition(g),v=f-m,b=u-e.eventHeight/2;t.push(o.a.createElement("rect",{key:"editingEvent",x:m,y:b,width:v,height:e.eventHeight,stroke:"black",strokeWidth:2,fill:"none"}));var y=u+e.eventHeight/2;t.push(o.a.createElement("rect",{key:"tip_rect",x:f+0,y:y+10,width:40,height:20,stroke:"black",strokeWidth:1,fill:"white"})),t.push(o.a.createElement("text",{key:"tip_text",x:f+0+20,y:y+10+10,dominantBaseline:"middle",textAnchor:"middle"},Math.abs(d-g).toFixed(1)))}return o.a.createElement("svg",{width:e.width,height:e.height,className:B.a.fill},t)};var te=function(e){for(var t=U(0,e.stages.length,e.leftBoundary,e.rightBoundary),a=[],n=0;n<e.stages.length;n++){var r=t(n);a.push(o.a.createElement("text",{key:"top_"+n,x:r,y:e.topBoundary,dominantBaseline:"hanging",fillOpacity:.5,fill:"darkgreen",fontWeight:"bold",fontSize:40},e.stages[n])),a.push(o.a.createElement("text",{key:"bottom_"+n,x:r,y:e.bottomBoundary,fillOpacity:.5,fill:"darkgreen",fontWeight:"bold",fontSize:40},e.stages[n]))}return o.a.createElement("svg",{width:e.width,height:e.height,className:B.a.fill},a)},ae=a(41);var ne=function(e){for(var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),n=parseInt(e-3600*t-60*a);a.length<2;)a="0"+a;for(;n.length<2;)n="0"+a;return t&&(t+=":"),t+a+":"+n};var oe=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleChange=n.handleChange.bind(Object(f.a)(n)),n.find_upanddown_v1=n.find_upanddown_v1.bind(Object(f.a)(n)),n.state={desat:null,show_err:0},n}return Object(l.a)(a,[{key:"find_upanddown_v1",value:function(e,t,a,n,o,r,s,i){var l,h,c,p,u=0,d=0;if(0===n){l=this.props.preData[r][i].data(Math.round(e+(this.props.data[i].dataLength-1)*(r+1))),h=this.props.preData[r][i].data(Math.round(e+(this.props.data[i].dataLength-1)*(r+1)));for(var g=1;g<=a/2;g++){var m=void 0,f=void 0;f=e+(this.props.data[i].dataLength-1)*(r+1)+g<this.props.data[i].dataLength-.5?this.props.preData[r][i].data(Math.round(e+(this.props.data[i].dataLength-1)*(r+1)+g)):r>0?this.props.preData[r-1][i].data(Math.round(e+(this.props.data[i].dataLength-1)*(r+1)+g-this.props.data[i].dataLength)):this.props.data[i].data(Math.round(e+(this.props.data[i].dataLength-1)*(r+1)+g-this.props.data[i].dataLength)),l<(m=e+(this.props.data[i].dataLength-1)*(r+1)-g>-.5?this.props.preData[r][i].data(Math.round(e+(this.props.data[i].dataLength-1)*(r+1)-g)):this.props.preData[r+1][i].data(Math.round(e+(this.props.data[i].dataLength-1)*(r+1)-g+this.props.data[i].dataLength)))&&(l=m),l<f&&(l=f),h>m&&(h=m),h>f&&(h=f)}u=l-h}else{l=this.props.data[i].data(Math.round(e)),h=this.props.data[i].data(Math.round(e));for(var v=1;v<=a/2;v++){var b=void 0,y=void 0;y=e+v<this.props.data[i].dataLength-.5?this.props.data[i].data(Math.round(e+v)):this.props.nextData[0][i].data(Math.round(e+v-this.props.data[i].dataLength)),l<(b=e-v>-.5?this.props.data[i].data(Math.round(e-v)):this.props.preData[0][i].data(Math.round(this.props.data[i].dataLength+(e-v))))&&(l=b),l<y&&(l=y),h>b&&(h=b),h>y&&(h=y)}u=l-h}if(0===o){c=this.props.nextData[s][i].data(Math.round(t-(this.props.data[i].dataLength-1)*(s+1))),p=this.props.nextData[s][i].data(Math.round(t-(this.props.data[i].dataLength-1)*(s+1)));for(var w=1;w<=a/2;w++){var S=void 0,E=void 0;E=t-(this.props.data[i].dataLength-1)*(s+1)+w<this.props.data[i].dataLength-.5?this.props.nextData[s][i].data(Math.round(t-(this.props.data[i].dataLength-1)*(s+1)+w)):this.props.nextData[s+1][i].data(Math.round(t-(this.props.data[i].dataLength-1)*(s+1)+w-this.props.data[i].dataLength)),c<(S=t-(this.props.data[i].dataLength-1)*(s+1)-w>-.5?this.props.nextData[s][i].data(Math.round(t-(this.props.data[i].dataLength-1)*(s+1)-w)):s>0?this.props.nextData[s-1][i].data(Math.round(t-(this.props.data[i].dataLength-1)*(s+1)-w+this.props.data[i].dataLength)):this.props.data[i].data(Math.round(t-(this.props.data[i].dataLength-1)*(s+1)-w+this.props.data[i].dataLength)))&&(c=S),c<E&&(c=E),p>S&&(p=S),p>E&&(p=E)}d=c-p}else{c=this.props.data[i].data(Math.round(t)),p=this.props.data[i].data(Math.round(t));for(var x=1;x<=a/2;x++){var I=void 0,C=void 0;C=t+x<this.props.data[i].dataLength-.5?this.props.data[i].data(Math.round(t+x)):this.props.nextData[0][i].data(Math.round(t+x-this.props.data[i].dataLength)),c<(I=t-x>-.5?this.props.data[i].data(Math.round(t-x)):this.props.preData[0][i].data(Math.round(this.props.data[i].dataLength+(t-x))))&&(c=I),c<C&&(c=C),p>I&&(p=I),p>C&&(p=C)}d=c-p}return d>u?1-u/d:-(1-d/u)}},{key:"handleChange",value:function(e){var t=e.target.value;this.props.onSelected(this.props.eventId,t),this.props.onCancel()}},{key:"render",value:function(){var e=this,t=this.props.getEventInfo(this.props.eventId),a=this.props.getChannelEvents(t.channelId),n=null;this.props.showDesat&&(n=o.a.createElement(o.a.Fragment,null,"Desat",o.a.createElement("br",null),this.state.desat));var r,s=null;if(2===t.channelId){for(var i=t.secondFrom>=this.props.secondFrom&&t.secondFrom<=this.props.secondTo?1:0,l=t.secondTo>=this.props.secondFrom&&t.secondTo<=this.props.secondTo?1:0,h=[],c=0;c<8;c++){var p=(this.props.data[c].dataLength-1)*(t.secondFrom-this.props.secondFrom)/(this.props.secondTo-this.props.secondFrom),u=(this.props.data[c].dataLength-1)*(t.secondTo-this.props.secondFrom)/(this.props.secondTo-this.props.secondFrom),d=0;if(i&&l)try{d=Math.abs(this.props.data[c].data(Math.round(p))-this.props.data[c].data(Math.round(u))).toFixed(1)}catch(M){console.log(M)}else if(0===i&&1===l)try{d=Math.abs(this.props.preData[0][c].data(Math.round(p+this.props.data[c].dataLength-1))-this.props.data[c].data(Math.round(u))).toFixed(1)}catch(M){console.log(M)}else if(1===i&&0===l)try{d=Math.abs(this.props.data[c].data(Math.round(p))-this.props.nextData[0][c].data(Math.round(u-this.props.data[c].dataLength+1))).toFixed(1)}catch(M){console.log(M)}else if(0===i&&0===l)try{d=Math.abs(this.props.preData[0][c].data(Math.round(p+this.props.data[c].dataLength-1))-this.props.nextData[0][c].data(Math.round(u-this.props.data[c].dataLength+1))).toFixed(1)}catch(M){console.log(M)}h.push(d)}s=o.a.createElement(o.a.Fragment,null,"\u8d77\u8a16\u9ede\u632f\u5e45",o.a.createElement("br",null),o.a.createElement("span",{style:{float:"left"}},"C3M2: ",o.a.createElement("b",null,h[0],"uv"),o.a.createElement("br",null),"C4M1: ",o.a.createElement("b",null,h[1],"uv"),o.a.createElement("br",null),"F3M2: ",o.a.createElement("b",null,h[2],"uv"),o.a.createElement("br",null),"F4M1: ",o.a.createElement("b",null,h[3],"uv")),o.a.createElement("span",{style:{float:"left",marginLeft:"10px"}},"O1M2: ",o.a.createElement("b",null,h[4],"uv"),o.a.createElement("br",null),"O2M1: ",o.a.createElement("b",null,h[5],"uv"),o.a.createElement("br",null),"E1M2: ",o.a.createElement("b",null,h[6],"uv"),o.a.createElement("br",null),"E2M1: ",o.a.createElement("b",null,h[7],"uv")),o.a.createElement("br",null))}else if(12===t.channelId){var g=t.secondFrom>=this.props.secondFrom&&t.secondFrom<=this.props.secondTo?1:0,m=t.secondTo>=this.props.secondFrom&&t.secondTo<=this.props.secondTo?1:0,f=0,v=0;if(0===g)for(var b=0;b<5;b++)t.secondFrom>=this.props.secondFrom-(b+1)*(this.props.secondTo-this.props.secondFrom)&&t.secondFrom<=this.props.secondTo-(b+1)*(this.props.secondTo-this.props.secondFrom)&&(f=b);if(0===m)for(var y=0;y<5;y++)t.secondTo>=this.props.secondFrom+(y+1)*(this.props.secondTo-this.props.secondFrom)&&t.secondTo<=this.props.secondTo+(y+1)*(this.props.secondTo-this.props.secondFrom)&&(v=y);v>2&&f>2&&(this.state.show_err=this.state.show_err+1),v>2&&f>2&&1===this.state.show_err&&alert("\u4e8b\u4ef6\u9801\u6578\u6709\u9ede\u591a\u56c9!\u8acb\u628a\u6642\u9593\u5927\u5c0f\u653e\u5927\u5427!");for(var w=[],E=1;E<5;E++){var x=(this.props.data[E].dataLength-1)*(t.secondFrom-this.props.secondFrom)/(this.props.secondTo-this.props.secondFrom),I=(this.props.data[E].dataLength-1)*(t.secondTo-this.props.secondFrom)/(this.props.secondTo-this.props.secondFrom),C=0;if(console.log(this.props.data[0].data(Math.round(x)),this.props.data[0].data(Math.round(I))),E<=2)C=(C=100*this.find_upanddown_v1(x,I,130,g,m,f,v,E)).toFixed(2),w.push(C);else{if(g&&m)try{C=Math.abs(this.props.data[E].data(Math.round(x))-this.props.data[E].data(Math.round(I))).toFixed(1)}catch(M){console.log(M)}else if(0===g&&1===m)try{C=Math.abs(this.props.preData[f][E].data(Math.round(x+(this.props.data[E].dataLength-1)*(f+1)))-this.props.data[E].data(Math.round(I))).toFixed(1)}catch(M){console.log(M)}else if(1===g&&0===m)try{C=Math.abs(this.props.data[E].data(Math.round(x))-this.props.nextData[v][E].data(Math.round(I-(this.props.data[E].dataLength-1)*(v+1)))).toFixed(1)}catch(M){console.log(M)}else if(0===g&&0===m)try{C=Math.abs(this.props.preData[f][E].data(Math.round(x+(this.props.data[E].dataLength-1)*(f+1)))-this.props.nextData[v][E].data(Math.round(I-(this.props.data[E].dataLength-1)*(v+1)))).toFixed(1)}catch(M){console.log(M)}w.push(C)}}s=o.a.createElement(o.a.Fragment,null,"\u8d77\u8a16\u9ede\u632f\u5e45",o.a.createElement("br",null),o.a.createElement("span",{style:{float:"left"}},"NPress: ",o.a.createElement("b",null,w[0],"%"),o.a.createElement("br",null),"Therm: ",o.a.createElement("b",null,w[1],"%")),o.a.createElement("span",{style:{float:"left",marginLeft:"10px"}},"Thor: ",o.a.createElement("b",null,w[2],"uv"),o.a.createElement("br",null),"Abdo: ",o.a.createElement("b",null,w[3],"uv")),o.a.createElement("br",null))}else if(16===t.channelId){var T=t.secondFrom>=this.props.secondFrom&&t.secondFrom<=this.props.secondTo?1:0,k=t.secondTo>=this.props.secondFrom&&t.secondTo<=this.props.secondTo?1:0,O=(this.props.data[5].dataLength-1)*(t.secondFrom-this.props.secondFrom)/(this.props.secondTo-this.props.secondFrom),D=(this.props.data[5].dataLength-1)*(t.secondTo-this.props.secondFrom)/(this.props.secondTo-this.props.secondFrom),F=0;if(T&&k)try{F=Math.abs(this.props.data[5].data(Math.round(O))-this.props.data[5].data(Math.round(D))).toFixed(1)}catch(M){console.log(M)}else if(0===T&&1===k)try{F=Math.abs(this.props.preData[0][5].data(Math.round(O+this.props.data[5].dataLength-1))-this.props.data[5].data(Math.round(D))).toFixed(1)}catch(M){console.log(M)}else if(1===T&&0===k)try{F=Math.abs(this.props.data[5].data(Math.round(O))-this.props.nextData[0][5].data(Math.round(D-this.props.data[5].dataLength+1))).toFixed(1)}catch(M){console.log(M)}else if(0===T&&0===k)try{F=Math.abs(this.props.preData[0][5].data(Math.round(O+this.props.data[5].dataLength-1))-this.props.nextData[0][5].data(Math.round(D-this.props.data[5].dataLength+1))).toFixed(1)}catch(M){console.log(M)}s=o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,F,"%"),o.a.createElement("br",null))}return o.a.createElement(ae.a,{show:this.props.visible,onHide:this.props.onCancel,size:"sm","aria-labelledby":"contained-modal-title-vcenter",centered:!0},o.a.createElement(ae.a.Header,{closeButton:!0},o.a.createElement(ae.a.Title,{id:"contained-modal-title-vcenter"},"Scored Event Info")),o.a.createElement(ae.a.Body,null,o.a.createElement("p",null,"Start",o.a.createElement("br",null),ne(t.secondFrom),o.a.createElement("br",null),"Duration",o.a.createElement("br",null),(r=t.secondFrom,(t.secondTo-r).toFixed(1)),o.a.createElement("br",null),s,n,o.a.createElement("br",null)),this.props.editable?o.a.createElement("select",{onChange:this.handleChange,size:"11",value:t.type,style:{overflow:"hidden"}},a?a.map((function(e){return o.a.createElement("option",{key:e,value:e},e)})):null):o.a.createElement("p",null,t.type)),this.props.editable?o.a.createElement(ae.a.Footer,null,o.a.createElement(S.a,{variant:"danger",onClick:function(){e.props.onDelete(e.props.eventId),e.props.onCancel()}},"Delete")):null)}},{key:"componentDidMount",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.showDesat){e.next=2;break}return e.abrupt("return");case 2:return t=this.props.getEventInfo(this.props.eventId),e.next=5,b.a.post("/calculate_spo2",{timeA:parseInt(t.secondFrom.toFixed(0)),timeB:parseInt(t.secondTo.toFixed(0)),psgFileId:this.props.psgFileId});case 5:a=e.sent,this.setState({desat:a.data.spo2.toFixed(1)});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(n.Component),re=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;Object(i.a)(this,a),(n=t.call(this,e)).channelIdToChannelNum={};for(var o=0;o<e.data.length;o++)n.channelIdToChannelNum[e.data[o].channelId]=o;return n.verticalPositionToChannelId=n.verticalPositionToChannelId.bind(Object(f.a)(n)),n.onRightDragStart=n.onRightDragStart.bind(Object(f.a)(n)),n.onRightDrag=n.onRightDrag.bind(Object(f.a)(n)),n.onRightDragEnd=n.onRightDragEnd.bind(Object(f.a)(n)),n.onLeftDragStart=n.onLeftDragStart.bind(Object(f.a)(n)),n.onLeftDrag=n.onLeftDrag.bind(Object(f.a)(n)),n.onLeftDragEnd=n.onLeftDragEnd.bind(Object(f.a)(n)),n.dragCancel=n.dragCancel.bind(Object(f.a)(n)),n.onMouseMove=n.onMouseMove.bind(Object(f.a)(n)),n.onMouseScroll=n.onMouseScroll.bind(Object(f.a)(n)),n.secondToXPosition=n.secondToXPosition.bind(Object(f.a)(n)),n.valueToYPosition=n.valueToYPosition.bind(Object(f.a)(n)),n.getChannelCenterline=n.getChannelCenterline.bind(Object(f.a)(n)),n.gravityToXPosition=n.gravityToXPosition.bind(Object(f.a)(n)),n.proportionToXPosition=n.proportionToXPosition.bind(Object(f.a)(n)),n.proportionToAbsoluteSecond=n.proportionToAbsoluteSecond.bind(Object(f.a)(n)),n.absoluteSecondToXPosition=n.absoluteSecondToXPosition.bind(Object(f.a)(n)),n.isMouseAtAnyEventBoundary=n.isMouseAtAnyEventBoundary.bind(Object(f.a)(n)),n.getEventWhoseBoundaryIsMouseAt=n.getEventWhoseBoundaryIsMouseAt.bind(Object(f.a)(n)),n.getEventWhichIsMouseOn=n.getEventWhichIsMouseOn.bind(Object(f.a)(n)),n.state={rightDraggingStart:null,rightDragging:null,rightDraggingChannel:null,leftDraggingStart:null,leftDragging:null,leftDraggingChannel:null,leftDraggingType:-1,editingEvent:null,eventInfoWindowEventId:null,eventInfoWindowVisible:!1},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){document.oncontextmenu=function(e){return e=e||window.event,!1}}},{key:"isMouseAtAnyEventBoundary",value:function(e,t){return null!==this.getEventWhoseBoundaryIsMouseAt(e,t)}},{key:"getEventWhoseBoundaryIsMouseAt",value:function(e,t){for(var a=5,n=null,o=0;o<this.props.events.length;o++){var r=this.props.events[o];if(r.channelId===e){if(r.secondFrom>=this.props.secondFrom){var s=this.absoluteSecondToXPosition(r.secondFrom),i=Math.abs(s-t);i<=a&&(a=i,n=Object.assign({nearestBoundary:"left"},r))}if(r.secondTo<=this.props.secondTo){var l=this.absoluteSecondToXPosition(r.secondTo),h=Math.abs(l-t);h<=a&&(a=h,n=Object.assign({nearestBoundary:"right"},r))}}}return n}},{key:"getEventWhichIsMouseOn",value:function(e,t){for(var a=U(this.props.leftSpace,this.props.width-this.props.rightSpace,this.props.secondFrom,this.props.secondTo)(t),n=0;n<this.props.events.length;n++){var o=this.props.events[n];if(o.channelId===e&&o.secondFrom<a&&a<o.secondTo)return Object.assign({},o)}return null}},{key:"verticalPositionToChannelId",value:function(e){for(var t=(this.props.height-this.props.topSpace-this.props.bottomSpace+this.props.interspace)/this.props.data.length-this.props.interspace,a=t/2,n=this.props.topSpace+a,o=0;o<this.props.data.length;o++){if(Math.abs(e-n)<=a)return this.props.data[o].channelId;n+=t+this.props.interspace}return-1}},{key:"onRightDragStart",value:function(e,t){if(!(t>1||t<0)&&-1!==e){var a=this.channelIdToChannelNum[e];this.props.data[a].draggable&&this.setState({rightDraggingStart:t,rightDraggingChannel:e})}}},{key:"onRightDrag",value:function(e){e=V(0,e,1),null!==this.state.rightDraggingStart&&this.setState({rightDragging:e})}},{key:"onRightDragEnd",value:function(e){if(e=V(0,e,1),-1===this.state.rightDraggingChannel||null===this.state.rightDraggingStart);else if(null===this.state.rightDragging){var t=this.proportionToAbsoluteSecond(this.state.rightDraggingStart),a=t+3;this.props.editable&&this.props.addEvent(this.state.rightDraggingChannel,t,a,this.props.getChannelEvents(this.state.rightDraggingChannel)[0],!1)}else if(e===this.state.rightDraggingStart)console.log("\u7121\u6548\u4e8b\u4ef6");else{var n=this.proportionToAbsoluteSecond(this.state.rightDraggingStart),o=this.proportionToAbsoluteSecond(e),r=Math.min(n,o),s=Math.max(n,o);this.props.editable&&this.props.addEvent(this.state.rightDraggingChannel,r,s,this.props.getChannelEvents(this.state.rightDraggingChannel)[0],!1)}var i=this.getEventWhichIsMouseOn(this.state.rightDraggingChannel,this.proportionToXPosition(e)-5);null===i&&(i=this.getEventWhichIsMouseOn(this.state.rightDraggingChannel,this.proportionToXPosition(e)+5)),null!==i&&2!==this.state.rightDraggingChannel&&17!==this.state.rightDraggingChannel&&18!==this.state.rightDraggingChannel?this.setState({eventInfoWindowEventId:i.eventId,eventInfoWindowVisible:!0,rightDragging:null,rightDraggingChannel:null,rightDraggingStart:null}):this.setState({rightDragging:null,rightDraggingChannel:null,rightDraggingStart:null})}},{key:"onLeftDragStart",value:function(e,t){var a=this.proportionToXPosition(t),n=this.getEventWhoseBoundaryIsMouseAt(e,a);if(null===n){if(t<0||t>1)return;null===(n=this.getEventWhichIsMouseOn(e,a))?(this.setState({leftDraggingStart:t,leftDraggingType:0,leftDraggingChannel:e}),this.props.moveCursor(this.proportionToAbsoluteSecond(t))):this.setState({leftDraggingStart:t,leftDraggingType:1,leftDraggingChannel:e,editingEvent:n})}else{var o=U(this.props.secondFrom,this.props.secondTo,0,1)("left"===n.nearestBoundary?n.secondFrom:"right"===n.nearestBoundary?n.secondTo:null);this.setState({leftDraggingStart:o,leftDraggingType:2,leftDraggingChannel:e,editingEvent:n})}}},{key:"onLeftDrag",value:function(e){e=V(0,e,1),this.setState({leftDragging:e}),0===this.state.leftDraggingType&&this.props.moveCursor(this.proportionToAbsoluteSecond(e))}},{key:"onLeftDragEnd",value:function(e){if(e=V(0,e,1),0===this.state.leftDraggingType)this.props.moveCursor(this.proportionToAbsoluteSecond(e));else if(1===this.state.leftDraggingType){var t=this.getEventWhichIsMouseOn(this.state.leftDraggingChannel,this.proportionToXPosition(e));null!==t&&t.eventId===this.state.editingEvent.eventId&&this.setState({eventInfoWindowEventId:t.eventId,eventInfoWindowVisible:!0})}else if(2===this.state.leftDraggingType&&null!==this.state.leftDragging){var a=this.state.editingEvent,n=this.proportionToAbsoluteSecond(e),o="left"===a.nearestBoundary?a.secondTo:"right"===a.nearestBoundary?a.secondFrom:null;this.props.deleteEvent(a.eventId);var r=Math.min(n,o),s=Math.max(n,o);this.props.editable&&this.props.addEvent(this.state.leftDraggingChannel,r,s,a.type,!0)}this.setState({leftDraggingStart:null,leftDragging:null,leftDraggingChannel:null,leftDraggingType:-1,editingEvent:null})}},{key:"dragCancel",value:function(){this.setState({rightDragging:null,rightDraggingChannel:null,rightDraggingStart:null,leftDraggingStart:null,leftDraggingChannel:null,leftDragging:null,leftDraggingType:-1,editingEvent:null})}},{key:"onMouseMove",value:function(e,t){var a=this.proportionToXPosition(t);this.props.editable&&(this.isMouseAtAnyEventBoundary(e,a)?document.body.style.cursor="ew-resize":document.body.style.cursor="auto")}},{key:"onMouseScroll",value:function(e,t){var a=!1,n=0;for(n=0;n<this.props.data.length;n++)if(this.props.data[n].channelId===e){a=this.props.data[n].zoomable;break}if(a){this.props.zoomChannel(e,t);var o=Object.assign({},this.state.scales);void 0===o[e]&&(o[e]=0),o[e]+=t?-1:1,o[e]=V(this.props.data[n].zoomMin,o[e],this.props.data[n].zoomMax),this.setState({scales:o})}}},{key:"proportionToXPosition",value:function(e){return U(0,1,this.props.leftSpace,this.props.width-this.props.rightSpace)(e)}},{key:"proportionToAbsoluteSecond",value:function(e){return U(0,1,this.props.secondFrom,this.props.secondTo)(e)}},{key:"absoluteSecondToXPosition",value:function(e){return U(this.props.secondFrom,this.props.secondTo,this.props.leftSpace,this.props.width-this.props.rightSpace)(e)}},{key:"secondToXPosition",value:function(e){return U(0,this.props.secondTo-this.props.secondFrom,this.props.leftSpace,this.props.width-this.props.rightSpace)(e)}},{key:"valueToYPosition",value:function(e,t){var a=this.channelIdToChannelNum[e],n=(this.props.height-this.props.topSpace-this.props.bottomSpace+this.props.interspace)/this.props.data.length-this.props.interspace,o=this.props.topSpace+(n+this.props.interspace)*a,r=o+n,s=this.props.data[a];return U(s.max,s.min,o,r)(t)}},{key:"getChannelCenterline",value:function(e){var t=this.channelIdToChannelNum[e],a=this.props.data[t];return this.valueToYPosition(e,(a.min+a.max)/2)}},{key:"gravityToXPosition",value:function(e){return"left"===e?0:"right"===e?this.props.leftSpace:this.props.leftSpace/2}},{key:"render",value:function(){var e=this,t=[];t.push(o.a.createElement(N,{key:"gridLayer",width:this.props.width,height:this.props.height,leftBoundary:this.props.leftSpace,rightBoundary:this.props.width-this.props.rightSpace,bottomBoundary:this.props.height-this.props.bottomSpace,topBoundary:this.props.topSpace,secondToXPosition:this.secondToXPosition,valueToYPosition:this.valueToYPosition,verticalLines:this.props.verticalLines,horizontalLines:this.props.horizontalLines,isZoomed:function(t){var a=e.channelIdToChannelNum[t];return 0!==e.props.data[a].zoom}}));var a=(this.props.height-this.props.topSpace-this.props.bottomSpace+this.props.interspace)/this.props.data.length-this.props.interspace;if(!1===this.props.loading)for(var n=function(n){var r=e.props.data[n].min,s=e.props.data[n].max,i=e.props.topSpace+n*(e.props.interspace+a),l=i+a,h=-1*e.props.data[n].zoom+1;h<=0&&(h=1);var c=void 0;c=16===e.props.data[n].channelId?function(e){return h*(100-e)+i}:U(r,s,l,i);var p=U(0,e.props.data[n].dataLength-1,e.props.leftSpace,e.props.width-e.props.rightSpace);t.push(o.a.createElement($,{chartKey:e.props.data[n].channelId+","+e.props.width+","+e.props.height+","+e.props.secondFrom+","+e.props.secondTo+","+r+","+s+","+h,key:n,width:e.props.width,height:e.props.height,lineWidth:e.props.data[n].lineWidth,dataLength:e.props.data[n].dataLength,data:e.props.data[n].data,xTransform:p,yTransform:c,color:e.props.data[n].color,showLocalExtreme:e.props.data[n].showLocalExtreme,cid:e.props.data[n].channelId}))},r=0;r<this.props.data.length;r++)n(r);var s=null;if(null!==this.state.rightDraggingStart&&null!==this.state.rightDragging&&-1!==this.state.rightDraggingChannel){s={};var i=U(0,1,0,this.props.secondTo-this.props.secondFrom);s.channelId=this.state.rightDraggingChannel;var l=i(this.state.rightDraggingStart),h=i(this.state.rightDragging);s.secondFrom=Math.min(l,h),s.secondTo=Math.max(l,h)}if(2===this.state.leftDraggingType&&null!==this.state.leftDragging){s={};var c=this.proportionToAbsoluteSecond(this.state.leftDragging);c-=this.props.secondFrom;var p=null;p="left"===this.state.editingEvent.nearestBoundary?V(this.props.secondFrom,this.state.editingEvent.secondTo,this.props.secondTo):V(this.props.secondFrom,this.state.editingEvent.secondFrom,this.props.secondTo),p-=this.props.secondFrom,s.secondFrom=Math.min(c,p),s.secondTo=Math.max(c,p),s.channelId=this.state.leftDraggingChannel}t.push(o.a.createElement(ee,{key:"eventsLayer",width:this.props.width,height:this.props.height,getChannelCenterline:this.getChannelCenterline,secondToXPosition:this.secondToXPosition,eventHeight:a,interval:this.props.secondTo-this.props.secondFrom,events:this.props.events.map((function(t,a){return{channelId:t.channelId,secondFrom:t.secondFrom-e.props.secondFrom,secondTo:t.secondTo-e.props.secondFrom,type:t.type,color:t.color,eventId:t.eventId}})),editingEvent:this.props.editable?s:null})),t.push(o.a.createElement(te,{key:"stageLayer",leftBoundary:this.props.leftSpace,rightBoundary:this.props.width-this.props.rightSpace,bottomBoundary:this.props.height-this.props.bottomSpace,topBoundary:this.props.topSpace,width:this.props.width,height:this.props.height,stages:this.props.stages}));var u=U(this.props.secondFrom,this.props.secondTo,0,1);t.push(o.a.createElement(X,{key:"cursorLineLayer",width:this.props.width,height:this.props.height,leftBoundary:this.props.leftSpace,rightBoundary:this.props.width-this.props.rightSpace,bottomBoundary:this.props.height-this.props.bottomSpace,topBoundary:this.props.topSpace,proportion:u(this.props.cursorSecond)}));var d=U(this.props.leftSpace,this.props.width-this.props.rightSpace,0,1);t.push(o.a.createElement(Z,{key:"labelLayer",width:this.props.width,height:this.props.height,gravityToXPosition:this.gravityToXPosition,labels:this.props.labels,valueToYPosition:this.valueToYPosition})),t.push(o.a.createElement(q,{key:"interactiveLayer",horizontalPositionToProportion:d,verticalPositionToChannelId:this.verticalPositionToChannelId,onRightDragStart:this.onRightDragStart,onRightDrag:this.onRightDrag,onRightDragEnd:this.onRightDragEnd,onLeftDragStart:this.onLeftDragStart,onLeftDrag:this.onLeftDrag,onLeftDragEnd:this.onLeftDragEnd,dragCancel:this.dragCancel,onMouseMove:this.onMouseMove,onMouseScroll:this.onMouseScroll}));var g=!1;if(null!==this.state.eventInfoWindowEventId){var m=this.props.getEventInfo(this.state.eventInfoWindowEventId);g=this.props.data[this.channelIdToChannelNum[m.channelId]].showDesat}return this.state.eventInfoWindowVisible&&t.push(o.a.createElement(oe,{key:"eventInfoWindow",editable:this.props.editable,onSelected:this.props.setEventType,onCancel:function(){e.setState({eventInfoWindowVisible:!1})},onDelete:this.props.deleteEvent,getEventInfo:this.props.getEventInfo,getChannelEvents:this.props.getChannelEvents,eventId:this.state.eventInfoWindowEventId,data:this.props.data,preData:this.props.preData,nextData:this.props.nextData,secondFrom:this.props.secondFrom,secondTo:this.props.secondTo,visible:!0,showDesat:g,psgFileId:this.props.psgFileId})),t}}]),a}(n.Component);re.defaultProps={data:[],width:800,height:800,topSpace:10,bottomSpace:10,interspace:5,leftSpace:30,rightSpace:10};var se=re,ie=a(73),le=a.n(ie);var he=function(e){var t=o.a.forwardRef((function(e,t){var a=e.children,n=e.onClick;return o.a.createElement("a",{href:"/#/",ref:t,className:le.a.timeIntervalDropdown,onClick:function(e){e.preventDefault(),n(e)}},a,"\u25bc")}));return o.a.createElement(I.a,{onSelect:e.selectItem},o.a.createElement(I.a.Toggle,{as:t,id:"dropdown-custom-components"},e.selectedItem),o.a.createElement(I.a.Menu,null,e.items.map((function(e){return o.a.createElement(I.a.Item,{key:e,eventKey:e},e)}))))},ce=a(74),pe=a(57),ue=a.n(pe),de=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).ref=o.a.createRef(),n.firstTime=!0,n.state={height:0,width:0,splittedPanelHeight:0},n.windowResize=n.windowResize.bind(Object(f.a)(n)),n.splittedPanelResize=n.splittedPanelResize.bind(Object(f.a)(n)),n}return Object(l.a)(a,[{key:"windowResize",value:function(){var e=this.ref.current;this.setState({width:e.offsetWidth,height:e.offsetHeight})}},{key:"splittedPanelResize",value:function(e){this.setState({splittedPanelHeight:e})}},{key:"render",value:function(){this.firstTime;var e=this.firstTime?o.a.createElement("div",{ref:this.ref,className:ue.a.signalPanel}):o.a.createElement("div",{ref:this.ref,className:ue.a.signalPanel},o.a.createElement(ce.a,{split:"horizontal",defaultSize:this.state.splittedPanelHeight,minSize:50,maxSize:-50,onChange:this.splittedPanelResize},o.a.createElement(o.a.Fragment,null,o.a.createElement(se,{loading:this.props.upperLoading,editable:this.props.editable,addEvent:this.props.addEvent,deleteEvent:this.props.deleteEvent,setEventType:this.props.setEventType,moveCursor:this.props.moveCursor,zoomChannel:this.props.zoomChannel,getEventInfo:this.props.getEventInfo,getChannelEvents:this.props.getChannelEvents,width:this.state.width,height:this.state.splittedPanelHeight,topSpace:5,bottomSpace:5,interspace:2,leftSpace:85,rightSpace:5,secondFrom:this.props.upperSecondFrom,secondTo:this.props.upperSecondTo,cursorSecond:this.props.cursorSecond,data:this.props.upperData,preData:this.props.preUpperData,nextData:this.props.nextUpperData,events:this.props.upperEvents,labels:this.props.upperLabels,verticalLines:this.props.upperVerticalLines,horizontalLines:this.props.upperHorizontalLines,stages:this.props.upperStages,psgFileId:this.props.psgFileId}),o.a.createElement("div",{style:{position:"absolute",left:"0px",right:"0px",height:"0px"}},o.a.createElement(he,{selectItem:this.props.upperSelectItem,items:this.props.upperItems,selectedItem:this.props.upperSelectedItem}))),o.a.createElement(o.a.Fragment,null,o.a.createElement(se,{loading:this.props.lowerLoading,editable:this.props.editable,addEvent:this.props.addEvent,deleteEvent:this.props.deleteEvent,setEventType:this.props.setEventType,moveCursor:this.props.moveCursor,zoomChannel:this.props.zoomChannel,getEventInfo:this.props.getEventInfo,getChannelEvents:this.props.getChannelEvents,width:this.state.width,height:this.state.height-this.state.splittedPanelHeight,topSpace:5,bottomSpace:5,interspace:2,leftSpace:85,rightSpace:5,secondFrom:this.props.lowerSecondFrom,secondTo:this.props.lowerSecondTo,cursorSecond:this.props.cursorSecond,data:this.props.lowerData,preData:this.props.preLowerData,nextData:this.props.nextLowerData,events:this.props.lowerEvents,labels:this.props.lowerLabels,verticalLines:this.props.lowerVerticalLines,horizontalLines:this.props.lowerHorizontalLines,stages:this.props.lowerStages,psgFileId:this.props.psgFileId}),o.a.createElement("div",{style:{position:"absolute",left:"0px",right:"0px",height:"0px"}},o.a.createElement(he,{selectItem:this.props.lowerSelectItem,items:this.props.lowerItems,selectedItem:this.props.lowerSelectedItem})))));return this.firstTime=!1,e}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.windowResize);var e=this.ref.current;this.setState({width:e.offsetWidth,height:e.offsetHeight,splittedPanelHeight:Math.floor(e.offsetHeight/2)})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.windowResize)}}]),a}(n.Component),ge=(a(107),a(60));function me(e){var t=Math.floor(e/30);return e%30===0&&t--,t}function fe(e){return Math.floor(e/30)}var ve=function(){function e(t,a,n,o){Object(i.a)(this,e);for(var r={},s={},l=-1,h=0;h<t.length;h++){var c=t[h],p=Object.assign({active:!0},c);void 0!==n[p.channelId]&&(p.channelId=n[p.channelId]),r[c.eventId]=p;for(var u=me(c.secondFrom),d=fe(c.secondTo),g=u;g<=d;g++)void 0===s[g]&&(s[g]=new Set),s[g].add(c.eventId);l=Math.max(l,c.eventId)}this.eventIdToEventObject=r,this.epochNumToEventId=s,this.nextEventId=l+1,this.colorsForChannels=Object.assign({},a),this.mappingIn=Object.assign({},n),this.mappingOut=Object.assign({},o)}return Object(l.a)(e,[{key:"getEventObjectByEventId",value:function(e){return Object.assign({},this.eventIdToEventObject[e])}},{key:"getEventObjectsByEventIds",value:function(e){for(var t=[],a=0;a<e.length;a++){var n=Object.assign({},this.eventIdToEventObject[e[a]]);if(n.color=this.colorsForChannels[n.channelId][n.type],t.push(n),void 0!==this.mappingOut[n.channelId])for(var o=Array.from(this.mappingOut[n.channelId]),r=0;r<o.length;r++){var s=Object.assign({},n);s.channelId=o[r],s.color=this.colorsForChannels[s.channelId][s.type],t.push(s)}}return t}},{key:"getEventIdsByEpoch",value:function(e){return void 0===this.epochNumToEventId[e]?[]:Array.from(this.epochNumToEventId[e])}},{key:"getEventIdsByTimeRangeAndChannelIds",value:function(e,t,a){var n=Math.floor((t-e)/30);n=0===n?1:n;for(var o=Math.floor(e/30),r=new Set,s=0;s<n;s++){var i=s+o;if(void 0!==this.epochNumToEventId[i])for(var l=Array.from(this.epochNumToEventId[i]),h=0;h<l.length;h++){var c=l[h],p=this.eventIdToEventObject[c];p.secondFrom<=t&&p.secondTo>=e&&a.has(p.channelId)&&r.add(c)}}return Array.from(r)}},{key:"addEvent",value:function(e,t,a,n,o){var r=this;void 0!==this.mappingIn[e]&&(e=this.mappingIn[e]);for(var s,i,l=me(t),h=fe(a),c=new Set,p=l;p<=h;p++)void 0!==this.epochNumToEventId[p]&&(s=c,i=this.epochNumToEventId[p],c=Array.from(new Set([].concat(Object(ge.a)(s),Object(ge.a)(i)))));var u=t,d=a,g=[],m=null;c.forEach((function(n,o,s){var i=r.eventIdToEventObject[n];i.channelId===e&&t<=i.secondTo&&a>=i.secondFrom&&(u=Math.min(u,i.secondFrom),d=Math.max(d,i.secondTo),g.push(i.eventId),(null===m||m.secondFrom>i.secondFrom)&&(m=i))}));for(var f=0;f<g.length;f++)this.deleteEvent(g[f]);!1===o&&null!==m&&(n=m.type);var v={secondFrom:u,secondTo:d,type:n,channelId:e,isActive:!0,eventId:this.nextEventId};this.eventIdToEventObject[this.nextEventId]=v;for(var b=me(u);b<=fe(d);b++)void 0===this.epochNumToEventId[b]&&(this.epochNumToEventId[b]=new Set),this.epochNumToEventId[b].add(this.nextEventId);var y={overlappedEventId:g,eventId:this.nextEventId,type:n};return this.nextEventId++,y}},{key:"deleteEvent",value:function(e){var t=this.eventIdToEventObject[e];if(void 0!==t){t.isActive=!1;for(var a=me(t.secondFrom),n=fe(t.secondTo),o=a;o<=n;o++)void 0!==this.epochNumToEventId[o]&&this.epochNumToEventId[o].delete(t.eventId)}}},{key:"setEventType",value:function(e,t){this.eventIdToEventObject[e].type=t}}]),e}(),be=Object.freeze({floatToFixed:5});function ye(e){return{"10 sec":10,"30 sec":30,"1 min":60,"2 min":120,"3 min":180,"5 min":300,"10 min":600}[e]}function we(e){return{10:"10 sec",30:"30 sec",60:"1 min",120:"2 min",180:"3 min",300:"5 min",600:"10 min"}[e]}var Se=function(){function e(t,a){Object(i.a)(this,e),this.timeFrom={},this.timeFrom[0]=t.upperTimeFrom,this.timeFrom[1]=t.lowerTimeFrom,this.timeInterval={},this.timeInterval[0]=ye(t.upperTimeInterval),this.timeInterval[1]=ye(t.lowerTimeInterval),this.totalEpoch=a,this.cursorLine=t.cursorLine}return Object(l.a)(e,[{key:"pageDown",value:function(){var e=this.timeInterval[0]<this.timeInterval[1]?0:1,t=0===e?1:0,a=this.timeInterval[e],n=30*this.totalEpoch;if(!(this.timeFrom[e]+a>=n)){this.cursorLine+=a,this.timeFrom[e]+=a;var o=this.timeFrom[e]+this.timeInterval[e]-n;if(o>0&&(this.timeFrom[e]-=o,this.cursorLine-=o),this.cursorLine=parseFloat(this.cursorLine.toFixed(be.floatToFixed)),this.cursorLine>this.timeFrom[t]+this.timeInterval[t]||this.cursorLine===this.timeFrom[e]&&this.cursorLine===this.timeFrom[t]+this.timeInterval[t]){this.timeFrom[t]+=this.timeInterval[t];var r=this.timeFrom[t]+this.timeInterval[t]-n;r>0&&(this.timeFrom[t]-=r)}}}},{key:"pageUp",value:function(){var e=this.timeInterval[0]<this.timeInterval[1]?0:1,t=0===e?1:0,a=this.timeInterval[e];if(!(this.timeFrom[e]<=0)){this.cursorLine-=a,this.timeFrom[e]-=a;var n=-this.timeFrom[e];if(n>0&&(this.timeFrom[e]+=n,this.cursorLine+=n),this.cursorLine=parseFloat(this.cursorLine.toFixed(be.floatToFixed)),this.cursorLine<this.timeFrom[t]||this.cursorLine===this.timeFrom[e]+this.timeInterval[e]&&this.cursorLine===this.timeFrom[t]){this.timeFrom[t]-=this.timeInterval[t];var o=-this.timeFrom[t];o>0&&(this.timeFrom[t]+=o)}}}},{key:"nextEpoch",value:function(){var e=30*this.totalEpoch;if(!(this.getCurrentEpoch()+1>=this.totalEpoch)&&(this.cursorLine+=30,this.timeFrom[0]+=30,this.cursorLine=parseFloat(this.cursorLine.toFixed(be.floatToFixed)),this.cursorLine>this.timeFrom[1]+this.timeInterval[1]||this.cursorLine===this.timeFrom[0]&&this.cursorLine===this.timeFrom[1]+this.timeInterval[1])){this.timeFrom[1]+=this.timeInterval[1];var t=this.timeFrom[1]+this.timeInterval[1]-e;t>0&&(this.timeFrom[1]-=t)}}},{key:"lastEpoch",value:function(){if(!(this.getCurrentEpoch()<=0)&&(this.cursorLine-=30,this.timeFrom[0]-=30,this.cursorLine=parseFloat(this.cursorLine.toFixed(be.floatToFixed)),this.cursorLine<this.timeFrom[1]||this.cursorLine===this.timeFrom[0]+this.timeInterval[0]&&this.cursorLine===this.timeFrom[1])){this.timeFrom[1]-=this.timeInterval[1];var e=-this.timeFrom[1];e>0&&(this.timeFrom[1]+=e)}}},{key:"jumpToEpoch",value:function(e){var t=this.cursorLine-this.timeFrom[0],a=30*e;this.timeFrom[1]=this.timeFrom[0]=a,this.cursorLine=a+t;var n=30*this.totalEpoch,o=this.timeFrom[1]+this.timeInterval[1]-n;o>0&&(this.timeFrom[1]-=o)}},{key:"moveCursor",value:function(e){e=parseFloat(e.toFixed(be.floatToFixed));var t=this.timeFrom[0],a=t+this.timeInterval[0];if(this.cursorLine=e,e<t||e>a){var n=Math.floor(e/this.timeInterval[0]);0===parseFloat((e%this.timeInterval[0]).toFixed(be.floatToFixed))&&n*this.timeInterval[0]===this.timeFrom[1]+this.timeInterval[1]?this.timeFrom[0]=(n-1)*this.timeInterval[0]:this.timeFrom[0]=n*this.timeInterval[0]}}},{key:"setUpperTimeInterval",value:function(e){if(this.timeInterval[0]=ye(e),this.timeInterval[0]===this.timeInterval[1])this.timeFrom[0]=this.timeFrom[1];else{var t=Math.floor(this.cursorLine/this.timeInterval[0]);0===parseFloat((this.cursorLine%this.timeInterval[0]).toFixed(be.floatToFixed))&&t*this.timeInterval[0]===this.timeFrom[1]+this.timeInterval[1]?this.timeFrom[0]=(t-1)*this.timeInterval[0]:this.timeFrom[0]=t*this.timeInterval[0]}}},{key:"setLowerTimeInterval",value:function(e){var t=this.getCurrentEpoch(),a=30*this.totalEpoch;if(this.timeInterval[1]=ye(e),this.timeInterval[1]===this.timeInterval[0])this.timeFrom[1]=this.timeFrom[0];else{this.timeFrom[1]=30*t;var n=this.timeFrom[1]+this.timeInterval[1]-a;n>0&&(this.timeFrom[1]-=n)}}},{key:"getCurrentEpoch",value:function(){var e=Math.floor(this.cursorLine/30);return 0===parseFloat((this.cursorLine%30).toFixed(be.floatToFixed))&&this.cursorLine===this.timeFrom[0]+this.timeInterval[0]&&e--,e}},{key:"getUpperSecondFrom",value:function(){return 30*this.totalEpoch>this.timeFrom[0]+this.timeInterval[0]?this.timeFrom[0]:this.timeFrom[0]-(this.timeFrom[0]+this.timeInterval[0]-30*this.totalEpoch)}},{key:"getUpperSecondTo",value:function(){return 30*this.totalEpoch>this.timeFrom[0]+this.timeInterval[0]?this.timeFrom[0]+this.timeInterval[0]:30*this.totalEpoch}},{key:"getUpperTimeInterval",value:function(){return we(this.timeInterval[0])}},{key:"getLowerSecondFrom",value:function(){return this.timeFrom[1]}},{key:"getLowerSecondTo",value:function(){return this.timeFrom[1]+this.timeInterval[1]}},{key:"getLowerTimeInterval",value:function(){return we(this.timeInterval[1])}},{key:"getCursorSecond",value:function(){return this.cursorLine}}]),e}(),Ee=function(){function e(t,a){Object(i.a)(this,e);for(var n={true:{},false:{}},o=0;o<t.length;o++){var r=t[o];n[r.upper][r.channelId]=Object.assign({zoom:0},r)}this.channelIdToChannelState=n,this.epochToArrayBuffer={true:{},false:{}},this.totalEpoch=a}return Object(l.a)(e,[{key:"checkData",value:function(e,t,a){var n=Math.floor(e/30),o=Math.floor(t/30);t%30===0&&o--;for(var r=[],s=n;s<=o;s++)void 0===this.epochToArrayBuffer[a][s]&&r.push(s);return r}},{key:"checkDataTimePoint",value:function(e,t){var a=Math.floor(e/30);return void 0===this.epochToArrayBuffer[t][a]?[a]:[]}},{key:"hasData",value:function(e,t,a){return 0===this.checkData(e,t,a).length}},{key:"setData",value:function(e,t,a){this.epochToArrayBuffer[a][t]=e}},{key:"getData",value:function(e,t,a){for(var n=this,o=this.channelIdToChannelState[a],r=Object.keys(o),s=[],i=function(i){var l=o[r[i]],h={};h.lineWidth=l.lineWidth;var c=(l.dataLength-1)/30,p=(t-e)*c+1;h.dataLength=p;var u=Math.floor(e/30),d=(e-30*u)*c,g=Math.floor(t/30),m=[];(g-=t%30===0?1:0)>n.totalEpoch&&(u-=(g=n.totalEpoch)-n.totalEpoch);for(var f=u;f<=g;f++){if(void 0===n.epochToArrayBuffer[a][f]){m=null;break}var v=new Float32Array(n.epochToArrayBuffer[a][f],l.offset,l.dataLength);m.push(v)}h.data=function(e){return function(e){if(null===m)return 0;var t=l.dataLength-1,a=Math.floor(e/t),n=e%t;return 0===n&&0!==a&&(a--,n+=t),m[a][n]}(e+d)};var b=void 0,y=void 0;if(16!==l.channelId){var w=(l.originalMax-l.originalMin)/2,S=(l.originalMax+l.originalMin)/2,E=w*Math.pow(2,l.zoom);b=S-E,y=S+E}else y=100,b=50;h.min=b,h.max=y,h.color=l.color,h.channelId=l.channelId,h.zoomable=l.zoomable,h.draggable=l.draggable,h.showDesat=l.showDesat,h.showLocalExtreme=l.showLocalExtreme,h.zoom=l.zoom,s.push(h)},l=0;l<r.length;l++)i(l);return s}},{key:"zoomChannel",value:function(e,t){var a=void 0===this.channelIdToChannelState[!0][e]?this.channelIdToChannelState[!1][e]:this.channelIdToChannelState[!0][e];a.zoom+=t?1:-1,a.zoom=a.zoom>a.maxZoom?a.maxZoom:a.zoom<a.minZoom?a.minZoom:a.zoom}},{key:"getChannelRange",value:function(e,t){var a=this.channelIdToChannelState[e][t];return(a.originalMax-a.originalMin)*Math.pow(2,a.zoom)}},{key:"getBuffered",value:function(){for(var e=new Array(this.totalEpoch),t=0;t<e.length;t++)e[t]=void 0!==this.epochToArrayBuffer[!0][t]&&void 0!==this.epochToArrayBuffer[!1][t];return e}},{key:"getNextEpochToBuffer",value:function(e){for(var t=e+1,a={};t<this.totalEpoch&&t-e<30;){if(a.upper=void 0===this.epochToArrayBuffer[!0][t],a.lower=void 0===this.epochToArrayBuffer[!1][t],a.upper||a.lower)return a.epoch=t,a;t++}return null}}]),e}(),xe=function(){function e(t){Object(i.a)(this,e),this.psgFileId=t,this.runningRequests={true:{},false:{}},this.completeRequest={true:new Set,false:new Set},this.results=[]}return Object(l.a)(e,[{key:"setRequest",value:function(e,t,a){var n=this;this.cb=a;for(var o={true:e,false:t},r={true:"/ajax_epoch_upper",false:"/ajax_epoch_lower"},s=[!0,!1],i=function(e){for(var t=s[e],a=o[t],i=Object.keys(n.runningRequests[t]),l=new Set(a),h=0;h<i.length;h++){var c=parseInt(i[h]);l.has(c)||(n.runningRequests[t][c].abort(),delete n.runningRequests[t][c])}for(var p=function(e){var o=a[e];if(void 0===n.runningRequests[t][o]&&!n.completeRequest[t].has(o)){var s=new XMLHttpRequest;s.open("POST",r[t],!0),s.responseType="arraybuffer",s.onload=function(e){var a={data:s.response,epoch:o,upper:t};if(n.results.push(a),n.completeRequest[t].add(o),delete n.runningRequests[t][o],0===Object.keys(n.runningRequests[!0]).length&&0===Object.keys(n.runningRequests[!1]).length){var r=n.results;n.results=[],n.completeRequest[!0]=new Set,n.completeRequest[!1]=new Set,n.cb(r)}},s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify({psgFileId:n.psgFileId,epochNum:o})),n.runningRequests[t][o]=s}},u=0;u<a.length;u++)p(u)},l=0;l<s.length;l++)i(l);if(0===Object.keys(this.runningRequests[!0]).length&&0===Object.keys(this.runningRequests[!1]).length&&0!==this.results.length){var h=this.results;this.results=[],this.completeRequest[!0]=new Set,this.completeRequest[!1]=new Set,this.cb(h)}}},{key:"clearResults",value:function(){var e=this.results;return this.results=[],this.completeRequest[!0]=new Set,this.completeRequest[!1]=new Set,e}}]),e}(),Ie=function(){function e(t,a){Object(i.a)(this,e),this.psgFileId=t,this.onStateChange=a,this.stages={},this.events=[],this.currentWindow=null,this.timer=null,this.requestQueue=[],this.currentId=0,this.sendingRequest=!1,this.state=0,this.toFlush=!1}return Object(l.a)(e,[{key:"queueRequest",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t,a,n,o,r,s,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.state=2,this.onStateChange(2),(t={}).psgFileId=this.psgFileId,a=[],n=Object.keys(this.stages),o=0;o<n.length;o++)r=parseInt(n[o]),a.push({epochNum:r,stage:this.stages[r]});if(t.stages=a,this.stages={},t.events=this.events,this.events=[],t.jump=this.currentWindow,this.currentWindow=null,this.requestQueue.push(t),!this.sendingRequest){e.next=16;break}return e.abrupt("return");case 16:this.sendingRequest=!0;case 17:if(0===this.requestQueue.length){e.next=36;break}return s=this.requestQueue.shift(),i=void 0,e.prev=20,e.next=23,b.a.post("/ajax_update_pause",s);case 23:i=e.sent,e.next=30;break;case 26:e.prev=26,e.t0=e.catch(20),window.alert("\u7121\u6cd5\u9023\u7dda"),window.location.reload();case 30:if(i.data.success){e.next=34;break}return alert(i.data.msg),window.history.go(0),e.abrupt("return");case 34:e.next=17;break;case 36:this.sendingRequest=!1,this.toFlush?(this.state=4,this.onStateChange(4),this.onAllSaved()):(this.state=3,this.onStateChange(3));case 38:case"end":return e.stop()}}),e,this,[[20,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"flush",value:function(e){if(3===this.state||0===this.state)return this.state=4,this.onStateChange(4),void e();1!==this.state&&2!==this.state||(null!==this.timer&&(clearTimeout(this.timer),this.timer=null),this.toFlush=!0,this.queueRequest(),this.onAllSaved=e)}},{key:"restartTimer",value:function(){var e=this;null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.timer=null,e.queueRequest()}),500),this.state=1,this.onStateChange(1)}},{key:"editStage",value:function(e,t){4!==this.state&&(this.stages[e]=t,this.restartTimer())}},{key:"editEvent",value:function(e,t,a,n,o,r){if(4!==this.state){var s={action:e,timeFrom:a,timeTo:n,eventId:t,channelId:o,type:r};this.events.push(s),this.restartTimer()}}},{key:"editCurrentWindow",value:function(e,t,a,n,o){4!==this.state&&(this.currentWindow={upperTimeFrom:e,lowerTimeFrom:t,upperTimeInterval:a,lowerTimeInterval:n,cursorLine:o},this.restartTimer())}}],[{key:"get_START",value:function(){return 0}},{key:"get_UNSAVED",value:function(){return 1}},{key:"get_SAVING",value:function(){return 2}},{key:"get_SAVED",value:function(){return 3}},{key:"get_END",value:function(){return 4}}]),e}();for(var Ce=function(e){return{1:[],2:["ARO SPONT"],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[],11:[],12:["Obstructive Apnea","Central Apnea","Mixed Apnea","Obstructive Hypopnea","Central Hypopnea","Mixed Hypopnea","Unsure Respiratory Event","Respiratory Artifact","Respiratory Paradox","Cheyne Stokes Breathing","RERA"],13:["Obstructive Apnea","Central Apnea","Mixed Apnea","Obstructive Hypopnea","Central Hypopnea","Mixed Hypopnea","Unsure Respiratory Event","Respiratory Artifact","Respiratory Paradox","Cheyne Stokes Breathing","RERA"],14:["Obstructive Apnea","Central Apnea","Mixed Apnea","Obstructive Hypopnea","Central Hypopnea","Mixed Hypopnea","Unsure Respiratory Event","Respiratory Artifact","Respiratory Paradox","Cheyne Stokes Breathing","RERA"],15:["Obstructive Apnea","Central Apnea","Mixed Apnea","Obstructive Hypopnea","Central Hypopnea","Mixed Hypopnea","Unsure Respiratory Event","Respiratory Artifact","Respiratory Paradox","Cheyne Stokes Breathing","RERA"],16:["SpO2 Desat","SpO2 Artifact"],17:["Limb movement (Left)"],18:["Limb movement (Right)"],19:[],20:[]}[e]},Te={1:{lineWidth:1,originalMin:-62.5,originalMax:62.5,maxZoom:5,minZoom:-5,color:"black",zoomable:!0,upper:!0,draggable:!1,showDesat:!1,showLocalExtreme:!1},2:{lineWidth:1,originalMin:-62.5,originalMax:62.5,maxZoom:5,minZoom:-5,color:"black",zoomable:!0,upper:!0,draggable:!0,showDesat:!1,showLocalExtreme:!1},3:{lineWidth:1,originalMin:-62.5,originalMax:62.5,maxZoom:5,minZoom:-5,color:"black",zoomable:!0,upper:!0,draggable:!1,showDesat:!1,showLocalExtreme:!1},4:{lineWidth:1,originalMin:-62.5,originalMax:62.5,maxZoom:5,minZoom:-5,color:"black",zoomable:!0,upper:!0,draggable:!1,showDesat:!1,showLocalExtreme:!1},5:{lineWidth:1,originalMin:-62.5,originalMax:62.5,maxZoom:5,minZoom:-5,color:"black",zoomable:!0,upper:!0,draggable:!1,showDesat:!1,showLocalExtreme:!1},6:{lineWidth:1,originalMin:-62.5,originalMax:62.5,maxZoom:5,minZoom:-5,color:"black",zoomable:!0,upper:!0,draggable:!1,showDesat:!1,showLocalExtreme:!1},7:{lineWidth:1,originalMin:-62.5,originalMax:62.5,maxZoom:5,minZoom:-5,color:"blue",zoomable:!0,upper:!0,draggable:!1,showDesat:!1,showLocalExtreme:!1},8:{lineWidth:1,originalMin:-62.5,originalMax:62.5,maxZoom:5,minZoom:-5,color:"blue",zoomable:!0,upper:!0,draggable:!1,showDesat:!1,showLocalExtreme:!1},9:{lineWidth:1,originalMin:-62.5,originalMax:62.5,maxZoom:5,minZoom:-5,color:"black",zoomable:!0,upper:!0,draggable:!1,showDesat:!1,showLocalExtreme:!1},10:{lineWidth:1,originalMin:-1,originalMax:1,maxZoom:5,minZoom:-5,color:"red",zoomable:!0,upper:!0,draggable:!1,showDesat:!1,showLocalExtreme:!1},11:{lineWidth:1,originalMin:-.5,originalMax:.5,maxZoom:5,minZoom:-5,color:"hotpink",zoomable:!0,upper:!1,draggable:!1,showDesat:!1,showLocalExtreme:!1},12:{lineWidth:1,originalMin:-.96,originalMax:.96,maxZoom:5,minZoom:-5,color:"green",zoomable:!0,upper:!1,draggable:!0,showDesat:!1,showLocalExtreme:!1},13:{lineWidth:1,originalMin:-416.665,originalMax:416.665,maxZoom:5,minZoom:-5,color:"black",zoomable:!0,upper:!1,draggable:!0,showDesat:!1,showLocalExtreme:!1},14:{lineWidth:1,originalMin:-104.165,originalMax:104.165,maxZoom:5,minZoom:-5,color:"green",zoomable:!0,upper:!1,draggable:!0,showDesat:!1,showLocalExtreme:!1},15:{lineWidth:1,originalMin:-104.165,originalMax:104.165,maxZoom:5,minZoom:-5,color:"green",zoomable:!0,upper:!1,draggable:!0,showDesat:!1,showLocalExtreme:!1},16:{lineWidth:1,originalMin:50,originalMax:100,maxZoom:0,minZoom:-10,color:"black",zoomable:!0,upper:!1,draggable:!0,showDesat:!0,showLocalExtreme:!0},17:{lineWidth:1,originalMin:-100,originalMax:100,maxZoom:5,minZoom:-5,color:"maroon",zoomable:!0,upper:!1,draggable:!0,showDesat:!1,showLocalExtreme:!1},18:{lineWidth:1,originalMin:-100,originalMax:100,maxZoom:5,minZoom:-5,color:"maroon",zoomable:!0,upper:!1,draggable:!0,showDesat:!1,showLocalExtreme:!1},19:{lineWidth:1,originalMin:0,originalMax:300,color:"black",zoomable:!1,upper:!1,draggable:!1,showDesat:!1,showLocalExtreme:!0},20:{lineWidth:1,originalMin:-2.5,originalMax:2.5,color:"maroon",zoomable:!1,upper:!1,draggable:!1,showDesat:!1,showLocalExtreme:!1}},ke={C3M2:1,C4M1:2,F3M2:3,F4M1:4,O1M2:5,O2M1:6,E1M2:7,E2M2:8,EMGR:9,ECG:10,Sound:11,NPress:12,Therm:13,Thor:14,Abdo:15,SpO2:16,LimbL:17,LimbR:18,Pulse:19,Position:20},Oe=Object.freeze({1:"uv",2:"uv",3:"uv",4:"uv",5:"uv",6:"uv",7:"uv",8:"uv",9:"uv",10:"mv",11:"mv",12:"cmH2O",13:"uv",14:"uv",15:"uv",16:"%",17:"uv",18:"uv",19:"bpm",20:""}),De=Object.freeze({1:{},2:{"ARO SPONT":"#b5c4f0"},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{},12:{"Obstructive Apnea":"#bf8975","Central Apnea":"#ff7a7a","Mixed Apnea":"#292e34","Obstructive Hypopnea":"#c4e2e2","Central Hypopnea":"#343961","Mixed Hypopnea":"#ffb9b9","Unsure Respiratory Event":"#ff4719","Respiratory Artifact":"#ffdab9","Respiratory Paradox":"#90251d","Cheyne Stokes Breathing":"#e3a624",RERA:"#1c2039"},13:{"Obstructive Apnea":"#bf8975","Central Apnea":"#ff7a7a","Mixed Apnea":"#292e34","Obstructive Hypopnea":"#c4e2e2","Central Hypopnea":"#343961","Mixed Hypopnea":"#ffb9b9","Unsure Respiratory Event":"#ff4719","Respiratory Artifact":"#ffdab9","Respiratory Paradox":"#90251d","Cheyne Stokes Breathing":"#e3a624",RERA:"#1c2039"},14:{"Obstructive Apnea":"#bf8975","Central Apnea":"#ff7a7a","Mixed Apnea":"#292e34","Obstructive Hypopnea":"#c4e2e2","Central Hypopnea":"#343961","Mixed Hypopnea":"#ffb9b9","Unsure Respiratory Event":"#ff4719","Respiratory Artifact":"#ffdab9","Respiratory Paradox":"#90251d","Cheyne Stokes Breathing":"#e3a624",RERA:"#1c2039"},15:{"Obstructive Apnea":"#bf8975","Central Apnea":"#ff7a7a","Mixed Apnea":"#292e34","Obstructive Hypopnea":"#c4e2e2","Central Hypopnea":"#343961","Mixed Hypopnea":"#ffb9b9","Unsure Respiratory Event":"#ff4719","Respiratory Artifact":"#ffdab9","Respiratory Paradox":"#90251d","Cheyne Stokes Breathing":"#e3a624",RERA:"#1c2039"},16:{"SpO2 Desat":"#71c3fa","SpO2 Artifact":"#e88db7"},17:{"Limb movement (Left)":"#e88db7"},18:{"Limb movement (Right)":"#e88db7"},19:{},20:{}}),Fe={1:{gravity:"center",channelId:1,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},2:{gravity:"center",channelId:2,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},3:{gravity:"center",channelId:3,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},4:{gravity:"center",channelId:4,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},5:{gravity:"center",channelId:5,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},6:{gravity:"center",channelId:6,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},7:{gravity:"center",channelId:7,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},8:{gravity:"center",channelId:8,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},9:{gravity:"center",channelId:9,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},10:{gravity:"center",channelId:10,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"}},Me={11:{gravity:"center",channelId:11,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},12:{gravity:"center",channelId:12,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},13:{gravity:"center",channelId:13,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},14:{gravity:"center",channelId:14,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},15:{gravity:"center",channelId:15,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},17:{gravity:"center",channelId:17,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"},18:{gravity:"center",channelId:18,value:0,xOffset:0,yOffset:7,color:"red",font:"12px Arial"}},Le={upperTimeFrom:0,lowerTimeFrom:0,upperTimeInterval:"30 sec",lowerTimeInterval:"30 sec",cursorLine:0},je=[],Ae=0;Ae<10;Ae++)je.push({lineWidth:1,dataLength:6e3,data:function(e){return 0},min:-1,max:1,color:"black",channelId:Ae+1,zoomable:!1});for(var Re=[],Pe=10;Pe<20;Pe++)Re.push({lineWidth:1,dataLength:6e3,data:function(e){return 0},min:-1,max:1,color:"black",channelId:Pe+1,zoomable:!1});var Be=[{label:"C3M2",gravity:"center",channelId:1,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"C4M1",gravity:"center",channelId:2,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"F3M2",gravity:"center",channelId:3,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"F4M1",gravity:"center",channelId:4,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"O1M2",gravity:"center",channelId:5,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"O2M1",gravity:"center",channelId:6,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"E1M2",gravity:"center",channelId:7,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"E2M1",gravity:"center",channelId:8,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"EMGR",gravity:"center",channelId:9,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"ECG",gravity:"center",channelId:10,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"}],ze=[{label:"Sound",gravity:"center",channelId:11,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"NPress",gravity:"center",channelId:12,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"Therm",gravity:"center",channelId:13,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"Thor",gravity:"center",channelId:14,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"Abdo",gravity:"center",channelId:15,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"SpO2",gravity:"center",channelId:16,value:75,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"%",gravity:"center",channelId:16,value:75,xOffset:0,yOffset:7,color:"black",font:"12px Arial"},{label:"100",gravity:"right",channelId:16,value:100,xOffset:-3,yOffset:0,color:"black",font:"8px Arial"},{label:"LimbL",gravity:"center",channelId:17,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"LimbR",gravity:"center",channelId:18,value:0,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"Pulse",gravity:"center",channelId:19,value:150,xOffset:0,yOffset:-7,color:"black",font:"15px Arial"},{label:"bpm",gravity:"center",channelId:19,value:150,xOffset:0,yOffset:7,color:"black",font:"12px Arial"},{label:"300",gravity:"right",channelId:19,value:300,xOffset:-3,yOffset:0,color:"black",font:"8px Arial"},{label:"0",gravity:"right",channelId:19,value:0,xOffset:-3,yOffset:0,color:"black",font:"8px Arial"},{label:"Position",gravity:"left",channelId:20,value:0,xOffset:3,yOffset:-7,color:"black",font:"15px Arial"},{label:"Right",gravity:"right",channelId:20,value:2,xOffset:-3,yOffset:0,color:"black",font:"8px Arial"},{label:"Supine",gravity:"right",channelId:20,value:1,xOffset:-3,yOffset:0,color:"black",font:"8px Arial"},{label:"Left",gravity:"right",channelId:20,value:0,xOffset:-3,yOffset:0,color:"black",font:"8px Arial"},{label:"Prone",gravity:"right",channelId:20,value:-1,xOffset:-3,yOffset:0,color:"black",font:"8px Arial"},{label:"Upright",gravity:"right",channelId:20,value:-2,xOffset:-3,yOffset:0,color:"black",font:"8px Arial"}];function We(e){for(var t=[],a=0;a<=20;a++)t.push({second:a/2,dashed:a%5!==0,color:"#73e68c"});for(var n=[],o=0;o<=60;o++)n.push({second:o/2,dashed:o%5!==0,color:"#73e68c"});for(var r=[],s=0;s<=2;s++)r.push({second:30*s,dashed:!1,color:"#73e68c"});for(var i=[],l=0;l<=4;l++)i.push({second:30*l,dashed:!1,color:"#73e68c"});for(var h=[],c=0;c<=6;c++)h.push({second:30*c,dashed:!1,color:"#73e68c"});for(var p=[],u=0;u<=10;u++)p.push({second:30*u,dashed:!1,color:"#73e68c"});for(var d=[],g=0;g<=20;g++)d.push({second:30*g,dashed:!1,color:"#73e68c"});return{"10 sec":t,"30 sec":n,"1 min":r,"2 min":i,"3 min":h,"5 min":p,"10 min":d}[e]}var _e=Object.freeze({0:"W",1:"1",2:"2",3:"3","-1":"R","-2":"?",10:""}),qe=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={display:!1,cursorSecond:0,upperSecondFrom:0,upperSecondTo:30,lowerSecondFrom:0,lowerSecondTo:30,upperData:[],lowerData:[],preUpperData:[],preLowerData:[],nextUpperData:[],nextLowerData:[],upperLabels:[],lowerLabels:[],upperEvents:[],lowerEvents:[],upperSelectedItem:"30 sec",lowerSelectedItem:"30 sec",stages:[],upperStages:[],lowerStages:[],answer:null,hasAnswer:!1,enableShowAnswerCheckbox:!0,currentEpoch:0,psgFileId:parseInt(e.match.params.id),which:parseInt(e.match.params.which),editable:0===parseInt(e.match.params.which),stateToShow:"",hasStagesBeenLoaded:!1,hasNotCompleted:!0,hasSubmitted:!1,modeArr:null},n.jumpTo=n.jumpTo.bind(Object(f.a)(n)),n.addEvent=n.addEvent.bind(Object(f.a)(n)),n.deleteEvent=n.deleteEvent.bind(Object(f.a)(n)),n.moveCursor=n.moveCursor.bind(Object(f.a)(n)),n.zoomChannel=n.zoomChannel.bind(Object(f.a)(n)),n.setEventType=n.setEventType.bind(Object(f.a)(n)),n.getEventInfo=n.getEventInfo.bind(Object(f.a)(n)),n.upperSelectItem=n.upperSelectItem.bind(Object(f.a)(n)),n.lowerSelectItem=n.lowerSelectItem.bind(Object(f.a)(n)),n.setStateFromDataStructure=n.setStateFromDataStructure.bind(Object(f.a)(n)),n.eventDataStructure=null,n.timeController=null,n.stagesDataStructure=null,n.answer=null,n.dataManager=null,n.dataRequestManager=null,n.pauseRequestManager=null,n.onKeyDown=n.onKeyDown.bind(Object(f.a)(n)),n.onRequestComplete=n.onRequestComplete.bind(Object(f.a)(n)),n.onStateChange=n.onStateChange.bind(Object(f.a)(n)),n.onShowAnswerChecked=n.onShowAnswerChecked.bind(Object(f.a)(n)),n.bufferTimer=null,n}return Object(l.a)(a,[{key:"setStateFromDataStructure",value:function(){for(var e=this.timeController.getCursorSecond(),t=this.timeController.getUpperSecondFrom(),a=this.timeController.getUpperSecondTo(),n=this.timeController.getLowerSecondFrom(),o=this.timeController.getLowerSecondTo(),r=this.dataManager.getData(t,a,!0),s=this.dataManager.getData(n,o,!1),i=a-t,l=[],h=[],c=[],p=[],u=0;u<5;u++)l[u]=this.dataManager.getData(t-(u+1)*i,a-(u+1)*i,!0);for(var d=o-n,g=0;g<5;g++)h[g]=this.dataManager.getData(n-(g+1)*d,o-(g+1)*d,!1);for(var m=0;m<5;m++)c[m]=this.dataManager.getData(t+(m+1)*i,a+(m+1)*i,!0);for(var f=0;f<5;f++)p[f]=this.dataManager.getData(n+(f+1)*d,o+(f+1)*d,!1);for(var v=[],b=0;b<Be.length;b++)v.push(Be[b]);for(var y=Object.keys(Fe),w=0;w<y.length;w++){var S=y[w],E=Object.assign({label:this.dataManager.getChannelRange(!0,S)+" "+Oe[S]},Fe[S]);v.push(E)}for(var x=[],I=0;I<ze.length;I++)x.push(ze[I]);for(var C=Object.keys(Me),T=0;T<C.length;T++){var k=C[T],O=Object.assign({label:this.dataManager.getChannelRange(!1,k)+" "+Oe[k]},Me[k]);x.push(O)}var D=new Set([1,2,3,4,5,6,7,8,9,10]),F=this.eventDataStructure.getEventIdsByTimeRangeAndChannelIds(t,a,D),M=this.eventDataStructure.getEventObjectsByEventIds(F),L=new Set([11,12,13,14,15,16,17,18,19,20]),j=this.eventDataStructure.getEventIdsByTimeRangeAndChannelIds(n,o,L),A=this.eventDataStructure.getEventObjectsByEventIds(j),R=this.timeController.getUpperTimeInterval(),P=this.timeController.getLowerTimeInterval(),B=Array.from(this.stagesDataStructure),z=Math.floor(t/30),W=Math.floor((a-t)/30);W=0===W?1:W;for(var _=[],q=0;q<W;q++){var N=z+q;_.push(_e[B[N]])}var U=Math.floor(n/30),H=Math.floor((o-n)/30);H=0===H?1:H;for(var X=[],Z=0;Z<H;Z++){var Y=U+Z;X.push(_e[B[Y]])}for(var K=this.timeController.getCurrentEpoch(),V=this.dataManager.getBuffered(),G=!1,Q=0;Q<B.length;Q++)if(10===B[Q]){G=!0;break}this.setState({display:!0,upperLoading:!this.dataManager.hasData(t,a,!0),lowerLoading:!this.dataManager.hasData(n,o,!1),cursorSecond:e,upperSecondFrom:t,upperSecondTo:a,lowerSecondFrom:n,lowerSecondTo:o,upperData:r,lowerData:s,preUpperData:l,preLowerData:h,nextUpperData:c,nextLowerData:p,upperLabel:v,lowerLabel:x,upperEvents:M,lowerEvents:A,upperSelectedItem:R,lowerSelectedItem:P,stages:B,upperStages:_,lowerStages:X,currentEpoch:K,buffered:V,hasNotCompleted:G})}},{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(R,{onComplete:function(){var t=0;for(var a in e.eventDataStructure.epochNumToEventId)t+=e.eventDataStructure.epochNumToEventId[a].size;t>0?(e.setState({hasSubmitted:!0}),e.pauseRequestManager.flush(Object(m.a)(g.a.mark((function t(){var a;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.a.post("/ajax_submit_stage",{psgFileId:e.state.psgFileId});case 2:if((a=t.sent).data.success){t.next=7;break}return alert(a.data.msg),window.history.go(0),t.abrupt("return");case 7:window.location.href="#";case 8:case"end":return t.stop()}}),t)}))))):window.confirm("\u5075\u6e2c\u5230\u60a8\u5c1a\u672a\u6709arousal\u548c\u547c\u5438\u4e8b\u4ef6\uff0c\u8acb\u554f\u662f\u5426\u7e73\u4ea4?")&&(e.setState({hasSubmitted:!0}),e.pauseRequestManager.flush(Object(m.a)(g.a.mark((function t(){var a;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.a.post("/ajax_submit_stage",{psgFileId:e.state.psgFileId});case 2:if((a=t.sent).data.success){t.next=7;break}return alert(a.data.msg),window.history.go(0),t.abrupt("return");case 7:window.location.href="#";case 8:case"end":return t.stop()}}),t)})))))},logout:function(){console.log("logout")},stateToShow:this.state.stateToShow,editable:this.state.editable,account:this.state.account,onLogout:function(){window.location.href="#"},onShowAnswerChecked:this.onShowAnswerChecked,enableShowAnswerCheckbox:this.state.enableShowAnswerCheckbox,hasAnswer:this.state.hasAnswer,buttonDisabled:this.state.hasNotCompleted||this.state.hasSubmitted,hasStagesBeenLoaded:this.state.hasStagesBeenLoaded}),this.state.display&&!this.state.hasSubmitted?o.a.createElement(o.a.Fragment,null,o.a.createElement(J,{leftSpace:20,rightSpace:10,topSpace:5,bottomSpace:5,stages:this.state.stages,modeArr:this.state.modeArr,answer:this.state.answer,currentEpoch:this.state.currentEpoch,jumpTo:this.jumpTo,buffered:this.state.buffered}),o.a.createElement("div",{style:{position:"absolute",textAlign:"center",fontWeight:"bold",left:"0px",right:"0px",height:"0px",top:"52px",color:"red",fontSize:"24px",opacity:"40%"}},"Cursor: "+ne(this.state.cursorSecond)+" Epoch: "+(parseInt(this.state.currentEpoch)+1)+" - "+_e[this.state.stages[this.state.currentEpoch]]),o.a.createElement(de,{upperLoading:this.state.upperLoading,lowerLoading:this.state.lowerLoading,editable:this.state.editable,addEvent:this.addEvent,deleteEvent:this.deleteEvent,setEventType:this.setEventType,moveCursor:this.moveCursor,zoomChannel:this.zoomChannel,getEventInfo:this.getEventInfo,getChannelEvents:Ce,cursorSecond:this.state.cursorSecond,upperSecondFrom:this.state.upperSecondFrom,upperSecondTo:this.state.upperSecondTo,upperData:this.state.upperData,preUpperData:this.state.preUpperData,nextUpperData:this.state.nextUpperData,lowerSecondFrom:this.state.lowerSecondFrom,lowerSecondTo:this.state.lowerSecondTo,lowerData:this.state.lowerData,preLowerData:this.state.preLowerData,nextLowerData:this.state.nextLowerData,upperEvents:this.state.upperEvents,lowerEvents:this.state.lowerEvents,upperLabels:this.state.upperLabel,lowerLabels:this.state.lowerLabel,upperVerticalLines:We(this.timeController.getUpperTimeInterval()),upperHorizontalLines:[{channelId:2,value:37.5,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:2,value:-37.5,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:3,value:37.5,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:3,value:-37.5,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:4,value:37.5,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:4,value:-37.5,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:2,value:0,dashed:!1,color:"#73e68c",zoomToShow:!0},{channelId:3,value:0,dashed:!1,color:"#73e68c",zoomToShow:!0},{channelId:4,value:0,dashed:!1,color:"#73e68c",zoomToShow:!0}],lowerVerticalLines:We(this.timeController.getLowerTimeInterval()),lowerHorizontalLines:[{channelId:16,value:50,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:16,value:60,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:16,value:70,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:16,value:80,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:16,value:90,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:16,value:100,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:20,value:-2,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:20,value:-1,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:20,value:0,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:20,value:1,dashed:!1,color:"#73e68c",zoomToShow:!1},{channelId:20,value:2,dashed:!1,color:"#73e68c",zoomToShow:!1}],upperStages:this.state.upperStages,lowerStages:this.state.lowerStages,upperSelectItem:this.upperSelectItem,upperItems:["10 sec","30 sec","1 min","2 min","3 min","5 min","10 min"],upperSelectedItem:this.state.upperSelectedItem,lowerSelectItem:this.lowerSelectItem,lowerItems:["10 sec","30 sec","1 min","2 min","3 min","5 min","10 min"],lowerSelectedItem:this.state.lowerSelectedItem,psgFileId:this.state.psgFileId})):null)}},{key:"componentDidMount",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t,a,n,o,r,s,i,l,h,c,p,u,d,m,f,v,y,w,S,E,x,I,C,T,k,O,D,F,M,L,j,A,R,P;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/ajax_who_am_i",{});case 2:if(void 0!==(t=e.sent.data.account)){e.next=6;break}return window.location.href="#",e.abrupt("return");case 6:return this.setState({account:t}),e.next=9,b.a.post("/ajax_ch_seg",{psgFileId:this.state.psgFileId});case 9:if((a=e.sent.data).success){e.next=14;break}return alert(a.msg),window.history.go(0),e.abrupt("return");case 14:for(n=a.upperChannels,o=a.lowerChannels,r=[],s=0;s<n.length;s++)i=n[s],l=ke[i.channelName],(h={}).offset=i.offset,h.dataLength=i.length,h.channelId=l,h=Object.assign(h,Te[l]),r.push(h);for(c=0;c<o.length;c++)p=o[c],u=ke[p.channelName],(d={}).offset=p.offset,d.dataLength=p.length,d.channelId=u,d=Object.assign(d,Te[u]),r.push(d);if(m=a.totalEpochNumber,this.dataManager=new Ee(r,m),f=parseInt(this.props.match.params.id),this.dataRequestManager=new xe(f),!this.state.editable){e.next=37;break}return e.next=26,b.a.post("/ajax_load_pause",{psgFileId:f});case 26:if((v=e.sent).data.success){e.next=31;break}return alert(v.data.msg),window.history.go(0),e.abrupt("return");case 31:this.eventDataStructure=new ve(v.data.events,De,{13:12,14:12,15:12},{12:new Set([13,14,15])}),this.timeController=new Se(v.data.jump,m),this.stagesDataStructure=v.data.stages,this.pauseRequestManager=new Ie(f,this.onStateChange),e.next=67;break;case 37:return e.next=39,b.a.post("/ajax_load_result",{psgFileId:f,scoringTimes:this.state.which});case 39:if((y=e.sent).data.success){e.next=44;break}return alert(y.data.msg),window.history.go(0),e.abrupt("return");case 44:for(w=y.data.events,S=1;S<=w.length;S++)w[S-1].eventId=S;return this.eventDataStructure=new ve(w,De,{13:12,14:12,15:12},{12:new Set([13,14,15])}),this.timeController=new Se(Le,m),this.stagesDataStructure=y.data.stages,this.pauseRequestManager=null,e.next=52,b.a.post("/ajax_load_stat",{psgFileId:f});case 52:if((E=e.sent).data.success){e.next=59;break}return alert(E.data.msg),window.history.go(0),e.abrupt("return");case 59:for(x=E.data.stat,I=new Array(m),C=0;C<I.length;C++)I[C]={"-1":0,"-2":0,0:0,1:0,2:0,3:0};for(T=0;T<x.length;T++)k=x[T].epoch,O=x[T].stage,D=x[T].count,I[k][O]=D;for(F=new Array(m),M=0;M<I.length;M++){for(L=0,j=null,A=Object.keys(I[M]),R=0;R<A.length;R++)I[M][A[R]]>L&&(L=I[M][A[R]],j=A[R]);F[M]=parseInt(j)}this.setState({modeArr:F}),console.log(F);case 67:return e.next=69,b.a.post("/ajax_has_answer",{psgFileId:f});case 69:if((P=e.sent).data.success){e.next=74;break}return alert(P.data.msg),window.history.go(0),e.abrupt("return");case 74:this.setState({hasStagesBeenLoaded:!0,hasAnswer:P.data.hasAnswer}),this.checkDataAndSendRequest(),document.addEventListener("keydown",this.onKeyDown);case 77:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){clearInterval(this.interval),this.unmount=!0,document.removeEventListener("keydown",this.onKeyDown)}},{key:"onKeyDown",value:function(e){if(null!==this.stagesDataStructure&&null!==this.timeController&&!this.state.hasSubmitted){var t=this.timeController.getCurrentEpoch();39===e.keyCode||40===e.keyCode||34===e.keyCode?(this.timeController.pageDown(),this.state.editable&&this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()):37!==e.keyCode&&38!==e.keyCode&&33!==e.keyCode||(this.timeController.pageUp(),this.state.editable&&this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()),this.state.editable&&(192===e.keyCode||96===e.keyCode||48===e.keyCode?(this.stagesDataStructure[t]=0,this.pauseRequestManager.editStage(t,0),this.timeController.nextEpoch(),this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()):49===e.keyCode||97===e.keyCode?(this.stagesDataStructure[t]=1,this.pauseRequestManager.editStage(t,1),this.timeController.nextEpoch(),this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()):50===e.keyCode||98===e.keyCode?(this.stagesDataStructure[t]=2,this.pauseRequestManager.editStage(t,2),this.timeController.nextEpoch(),this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()):51===e.keyCode||99===e.keyCode?(this.stagesDataStructure[t]=3,this.pauseRequestManager.editStage(t,3),this.timeController.nextEpoch(),this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()):53===e.keyCode||101===e.keyCode?(this.stagesDataStructure[t]=-1,this.pauseRequestManager.editStage(t,-1),this.timeController.nextEpoch(),this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()):window.event.shiftKey&&191===e.keyCode&&(this.stagesDataStructure[t]=-2,this.pauseRequestManager.editStage(t,-2),this.timeController.nextEpoch(),this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()))}}},{key:"startBuffer",value:function(){var e=0;null!==(e=this.timeController.getCurrentEpoch()<=5?this.dataManager.getNextEpochToBuffer(-1):this.dataManager.getNextEpochToBuffer(this.timeController.getCurrentEpoch()-7))&&this.dataRequestManager.setRequest(e.upper?[e.epoch]:[],e.lower?[e.epoch]:[],this.onRequestComplete)}},{key:"onRequestComplete",value:function(e){if(!this.unmount){for(var t=0;t<e.length;t++)this.dataManager.setData(e[t].data,e[t].epoch,e[t].upper);this.setStateFromDataStructure(),this.startBuffer()}}},{key:"checkDataAndSendRequest",value:function(){var e=this,t=this.timeController.getUpperSecondFrom(),a=this.timeController.getUpperSecondTo(),n=this.dataManager.checkData(t,a,!0),o=this.timeController.getLowerSecondFrom(),r=this.timeController.getLowerSecondTo(),s=this.dataManager.checkData(o,r,!1);0!==n.length||0!==s.length?this.dataRequestManager.setRequest(n,s,(function(t){e.onRequestComplete(t)})):this.startBuffer()}},{key:"jumpTo",value:function(e){this.timeController.jumpToEpoch(e),this.state.editable&&this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()}},{key:"addEvent",value:function(e,t,a,n,o){t=parseFloat(t.toFixed(be.floatToFixed)),a=parseFloat(a.toFixed(be.floatToFixed));var r=30*this.stagesDataStructure.length;a=a>r?r:a;for(var s=this.eventDataStructure.addEvent(e,t,a,n,o),i=0;i<s.overlappedEventId.length;i++)this.pauseRequestManager.editEvent("delete",s.overlappedEventId[i],null,null,null,null);var l=this.eventDataStructure.getEventObjectByEventId(s.eventId);this.pauseRequestManager.editEvent("add",s.eventId,l.secondFrom,l.secondTo,l.channelId,l.type),this.setStateFromDataStructure()}},{key:"deleteEvent",value:function(e){this.eventDataStructure.deleteEvent(e),this.pauseRequestManager.editEvent("delete",e,null,null,null,null),this.setStateFromDataStructure()}},{key:"moveCursor",value:function(e){this.timeController.moveCursor(e),this.state.editable&&this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()}},{key:"zoomChannel",value:function(e,t){this.dataManager.zoomChannel(e,t),this.setStateFromDataStructure()}},{key:"upperSelectItem",value:function(e){this.timeController.setUpperTimeInterval(e),this.state.editable&&this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()}},{key:"lowerSelectItem",value:function(e){this.timeController.setLowerTimeInterval(e),this.state.editable&&this.pauseRequestManager.editCurrentWindow(this.timeController.getUpperSecondFrom(),this.timeController.getLowerSecondFrom(),this.timeController.getUpperTimeInterval(),this.timeController.getLowerTimeInterval(),this.timeController.getCursorSecond()),this.checkDataAndSendRequest(),this.setStateFromDataStructure()}},{key:"setEventType",value:function(e,t){this.eventDataStructure.setEventType(e,t),this.pauseRequestManager.editEvent("set",e,null,null,null,t),this.setStateFromDataStructure()}},{key:"getEventInfo",value:function(e){return this.eventDataStructure.getEventObjectByEventId(e)}},{key:"onStateChange",value:function(e){var t={};t[Ie.get_START()]="",t[Ie.get_UNSAVED()]="\u5c1a\u672a\u5132\u5b58",t[Ie.get_SAVING()]="\u5132\u5b58\u4e2d",t[Ie.get_SAVED()]="\u5df2\u5132\u5b58",t[Ie.get_END()]="\u5df2\u5b8c\u6210";var a=t[e];this.setState({stateToShow:a})}},{key:"onShowAnswerChecked",value:function(){var e=Object(m.a)(g.a.mark((function e(t){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=17;break}if(null!==this.answer){e.next=14;break}return this.setState({enableShowAnswerCheckbox:!1}),e.next=5,b.a.post("/ajax_answer",{psgFileId:this.state.psgFileId});case 5:if((a=e.sent).data.success){e.next=10;break}return alert(a.data.msg),window.history.go(0),e.abrupt("return");case 10:this.answer=a.data.data,this.setState({enableShowAnswerCheckbox:!0,answer:this.answer}),e.next=15;break;case 14:this.setState({answer:this.answer});case 15:e.next=18;break;case 17:this.setState({answer:null});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(n.Component),Ne=function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleSubmit=n.handleSubmit.bind(Object(f.a)(n)),n.state={account:null,errorMessage:null,waitingForResult:!1},n}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(F,{account:this.state.account,onLogout:function(){window.location.href="/#/"}}),null!==this.state.account?o.a.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)"}},o.a.createElement(y.a,{style:{width:"30rem"}},o.a.createElement(y.a.Header,{as:"h5"},"\u66f4\u6539\u5bc6\u78bc"),o.a.createElement(y.a.Body,null,o.a.createElement(w.a,{onSubmit:this.handleSubmit},o.a.createElement(w.a.Group,{controlId:"originalPass"},o.a.createElement(w.a.Label,null,"\u539f\u4f86\u7684\u5bc6\u78bc"),o.a.createElement(w.a.Control,{type:"password"})),o.a.createElement(w.a.Group,{controlId:"newPass"},o.a.createElement(w.a.Label,null,"\u65b0\u5bc6\u78bc"),o.a.createElement(w.a.Control,{type:"password"})),o.a.createElement(w.a.Group,{controlId:"newPass2"},o.a.createElement(w.a.Label,null,"\u5bc6\u78bc\u78ba\u8a8d"),o.a.createElement(w.a.Control,{type:"password"})),this.state.errorMessage?o.a.createElement(E.a,{variant:"danger"},this.state.errorMessage):null,o.a.createElement(S.a,{variant:"primary",type:"submit",disabled:this.state.waitingForResponse},"\u66f4\u6539"))))):null,o.a.createElement(M,null))}},{key:"componentDidMount",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/ajax_who_am_i",{});case 2:if(void 0!==(t=e.sent).data.account){e.next=6;break}return window.location.href="#",e.abrupt("return");case 6:this.setState({account:t.data.account});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleSubmit",value:function(){var e=Object(m.a)(g.a.mark((function e(t){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({waitingForResponse:!0,errorMessage:null}),e.next=4,b.a.post("/ajax_reset_pass",{oldPass:t.target.elements.originalPass.value,newPass:t.target.elements.newPass.value,newPass2:t.target.elements.newPass2.value});case 4:a=e.sent,this.setState({waitingForResponse:!1}),a.data.success?window.location.href="/#/":(console.log(a.data.msg),this.setState({errorMessage:a.data.msg}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(n.Component),Ue=(a(108),function(e){Object(h.a)(a,e);var t=Object(c.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement(p.a,null,o.a.createElement(u.c,null,o.a.createElement(u.a,{exact:!0,path:"/",component:L}),o.a.createElement(u.a,{exact:!0,path:"/hidden",component:A}),o.a.createElement(u.a,{exact:!0,path:"/scoring/:id/:which",component:qe}),o.a.createElement(u.a,{exact:!0,path:"/setpass",component:Ne})))}},{key:"componentDidMount",value:function(){document.title="Scoring Web"}}]),a}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(Ue,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},18:function(e,t,a){e.exports={fill:"fillStyle_fill__3GHgC",redLine:"fillStyle_redLine__2jWxf"}},56:function(e,t,a){e.exports={hypnogram:"hypnogramStyle_hypnogram__1E8eM"}},57:function(e,t,a){e.exports={signalPanel:"signalPanelStyle_signalPanel__2lg6T"}},72:function(e,t,a){e.exports={chartLayer:"chartLayerStyle_chartLayer__22Hu0"}},73:function(e,t,a){e.exports={timeIntervalDropdown:"timeIntervalDropdownStyle_timeIntervalDropdown__gi6Id"}},78:function(e,t,a){e.exports=a(112)},83:function(e,t,a){}},[[78,1,2]]]);
//# sourceMappingURL=main.6d51be96.chunk.js.map